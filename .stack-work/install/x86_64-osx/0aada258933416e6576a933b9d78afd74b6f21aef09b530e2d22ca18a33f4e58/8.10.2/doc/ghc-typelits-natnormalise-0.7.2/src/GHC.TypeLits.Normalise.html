<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Copyright  :  (C) 2015-2016, University of Twente,
                  2017     , QBayLogic B.V.
License    :  BSD2 (see the file LICENSE)
Maintainer :  Christiaan Baaij &lt;christiaan.baaij@gmail.com&gt;

A type checker plugin for GHC that can solve /equalities/ of types of kind
'GHC.TypeLits.Nat', where these types are either:

* Type-level naturals
* Type variables
* Applications of the arithmetic expressions @(+,-,*,^)@.

It solves these equalities by normalising them to /sort-of/
'GHC.TypeLits.Normalise.SOP.SOP' (Sum-of-Products) form, and then perform a
simple syntactic equality.

For example, this solver can prove the equality between:

@
(x + 2)^(y + 2)
@

and

@
4*x*(2 + x)^y + 4*(2 + x)^y + (2 + x)^y*x^2
@

Because the latter is actually the 'GHC.TypeLits.Normalise.SOP.SOP' normal form
of the former.

To use the plugin, add

@
{\-\# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise \#-\}
@

To the header of your file.

== Treating subtraction as addition with a negated number

If you are absolutely sure that your subtractions can /never/ lead to (a locally)
negative number, you can ask the plugin to treat subtraction as addition with
a negated operand by additionally adding:

@
{\-\# OPTIONS_GHC -fplugin-opt GHC.TypeLits.Normalise:allow-negated-numbers \#-\}
@

to the header of your file, thereby allowing to use associativity and
commutativity rules when proving constraints involving subtractions. Note that
this option can lead to unsound behaviour and should be handled with extreme
care.

=== When it leads to unsound behaviour

For example, enabling the /allow-negated-numbers/ feature would allow
you to prove:

@
(n - 1) + 1 ~ n
@

/without/ a @(1 &lt;= n)@ constraint, even though when /n/ is set to /0/ the
subtraction @n-1@ would be locally negative and hence not be a natural number.

This would allow the following erroneous definition:

@
data Fin (n :: Nat) where
  FZ :: Fin (n + 1)
  FS :: Fin n -&gt; Fin (n + 1)

f :: forall n . Natural -&gt; Fin n
f n = case of
  0 -&gt; FZ
  x -&gt; FS (f \@(n-1) (x - 1))

fs :: [Fin 0]
fs = f \&lt;$\&gt; [0..]
@

=== When it might be Okay

This example is taken from the &lt;http://hackage.haskell.org/package/mezzo mezzo&gt;
library.

When you have:

@
-- | Singleton type for the number of repetitions of an element.
data Times (n :: Nat) where
    T :: Times n

-- | An element of a &quot;run-length encoded&quot; vector, containing the value and
-- the number of repetitions
data Elem :: Type -&gt; Nat -&gt; Type where
    (:*) :: t -&gt; Times n -&gt; Elem t n

-- | A length-indexed vector, optimised for repetitions.
data OptVector :: Type -&gt; Nat -&gt; Type where
    End  :: OptVector t 0
    (:-) :: Elem t l -&gt; OptVector t (n - l) -&gt; OptVector t n
@

And you want to define:

@
-- | Append two optimised vectors.
type family (x :: OptVector t n) ++ (y :: OptVector t m) :: OptVector t (n + m) where
    ys        ++ End = ys
    End       ++ ys = ys
    (x :- xs) ++ ys = x :- (xs ++ ys)
@

then the last line will give rise to the constraint:

@
(n-l)+m ~ (n+m)-l
@

because:

@
x  :: Elem t l
xs :: OptVector t (n-l)
ys :: OptVector t m
@

In this case it's okay to add

@
{\-\# OPTIONS_GHC -fplugin-opt GHC.TypeLits.Normalise:allow-negated-numbers \#-\}
@

if you can convince yourself you will never be able to construct a:

@
xs :: OptVector t (n-l)
@

where /n-l/ is a negative number.
-}</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-pragma">{-# LANGUAGE CPP             #-}</span><span>
</span><span id="line-147"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase      #-}</span><span>
</span><span id="line-148"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns  #-}</span><span>
</span><span id="line-149"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-150"></span><span class="hs-pragma">{-# LANGUAGE TupleSections   #-}</span><span>
</span><span id="line-151"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns    #-}</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="hs-pragma">{-# OPTIONS_HADDOCK show-extensions #-}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.TypeLits.Normalise</span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier">plugin</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-keyword">where</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-comment">-- external</span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">second</span></span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(&lt;=&lt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if !MIN_VERSION_ghc(8,4,1)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier">replicateM</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Trans.Writer.Strict</span></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Either</span></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">partitionEithers</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">rights</span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">intersect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">partition</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">stripPrefix</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">find</span></span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">mapMaybe</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">catMaybes</span></span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">notMember</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromList</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">union</span></span><span class="hs-special">)</span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TcPluginM.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tracePlugin</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newGiven</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">newWanted</span></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TcPluginM.Extra</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,4,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">GHC.TcPluginM.Extra</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">flattenGivens</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Text.Read</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">readMaybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>
</span><span id="line-177"></span><span class="hs-comment">-- GHC API</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,5,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">CoreSyn</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Expr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Outputable</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">($$)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">text</span></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plugins</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Plugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultPlugin</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plugins</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">purePlugin</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PrelNames</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">hasKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">knownNatClassName</span></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PrelNames</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">eqTyConKey</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">heqTyConKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcEvidence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EvTerm</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcEvidence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">evCast</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#if !MIN_VERSION_ghc(8,4,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcPluginM</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">zonkCt</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcPluginTrace</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcPluginIO</span></span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>       </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Kind</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">eqType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkTyVarTy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tyConAppTyCon_maybe</span></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TysWiredIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeNatKind</span></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Coercion</span></span><span>   </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CoercionHole</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Role</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkUnivCo</span></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginM</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">newCoercionHole</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tcLookupClass</span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcRnTypes</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TcPlugin</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcPluginResult</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TyCoRep</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnivCoProvenance</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isEqPred</span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TyCoRep</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Type</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcTypeNats</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeNatAddTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeNatExpTyCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">typeNatMulTyCon</span></span><span class="hs-special">,</span><span>
</span><span id="line-206"></span><span>                   </span><span class="annot"><span class="hs-identifier">typeNatSubTyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcTypeNats</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeNatLeqTyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TysWiredIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">promotedFalseDataCon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">promotedTrueDataCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.IORef</span></span><span class="hs-cpp">

#if MIN_VERSION_ghc(8,10,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Constraint</span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Ct</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtEvidence</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CtLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TcEvDest</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvidence</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctEvPred</span></span><span class="hs-special">,</span><span>
</span><span id="line-215"></span><span>   </span><span class="annot"><span class="hs-identifier">ctLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ctLocSpan</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isGiven</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isWanted</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkNonCanonical</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setCtLoc</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">setCtLocSpan</span></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>   </span><span class="annot"><span class="hs-identifier">isWantedCt</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Predicate</span></span><span>
</span><span id="line-218"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EqRel</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NomEq</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Pred</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">EqPred</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">classifyPredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getEqPredTys</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mkClassPred</span></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>   </span><span class="annot"><span class="hs-identifier">mkPrimEqPred</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">typeKind</span></span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcRnTypes</span><span>
</span><span id="line-223"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">Ct</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CtEvidence</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CtLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TcEvDest</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctEvidence</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctEvLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctEvPred</span><span class="hs-special">,</span><span>
</span><span id="line-224"></span><span>   </span><span class="hs-identifier">ctLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ctLocSpan</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isGiven</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isWanted</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkNonCanonical</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setCtLoc</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setCtLocSpan</span><span class="hs-special">,</span><span>
</span><span id="line-225"></span><span>   </span><span class="hs-identifier">isWantedCt</span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcType</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">typeKind</span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Type</span><span>
</span><span id="line-228"></span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">EqRel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">NomEq</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PredTree</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">EqPred</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">classifyPredType</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getEqPredTys</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">mkClassPred</span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>   </span><span class="hs-identifier">mkPrimEqPred</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,10,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Constraint</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ctEvExpr</span></span><span class="hs-special">)</span><span class="hs-cpp">
#elif MIN_VERSION_ghc(8,6,0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcRnTypes</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ctEvExpr</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcRnTypes</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ctEvTerm</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,2,0)
</span><span class="hs-cpp">#if MIN_VERSION_ghc(8,10,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Constraint</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ShadowInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">WDeriv</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">TcRnTypes</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier">ShadowInfo</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">WDeriv</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-cpp">#endif
</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,10,0)
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isEqPrimPred</span></span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-252"></span><span class="hs-comment">-- internal</span><span>
</span><span id="line-253"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html"><span class="hs-identifier">GHC.TypeLits.Normalise.SOP</span></a></span><span>
</span><span id="line-254"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html"><span class="hs-identifier">GHC.TypeLits.Normalise.Unify</span></a></span><span class="hs-cpp">

#if !MIN_VERSION_ghc(8,10,0)
</span><span class="hs-identifier">isEqPrimPred</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">PredType</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><span id="line-258"></span><span class="hs-identifier">isEqPrimPred</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">isEqPred</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-261"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-type">isEqPredClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-262"></span><span id="isEqPredClass"><span class="annot"><span class="annottext">isEqPredClass :: PredType -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-var hs-var">isEqPredClass</span></a></span></span><span> </span><span id="local-6989586621679115529"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115529"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Maybe TyCon
</span><span class="hs-identifier hs-var">tyConAppTyCon_maybe</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115529"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-263"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679115528"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115528"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115528"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><span class="hs-operator hs-var">`hasKey`</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><span class="hs-identifier hs-var">eqTyConKey</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115528"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><span class="hs-operator hs-var">`hasKey`</span></span><span> </span><span class="annot"><span class="annottext">Unique
</span><span class="hs-identifier hs-var">heqTyConKey</span></span><span>
</span><span id="line-264"></span><span>  </span><span class="annot"><span class="annottext">Maybe TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span class="hs-comment">-- | To use the plugin, add</span><span>
</span><span id="line-267"></span><span class="hs-comment">--</span><span>
</span><span id="line-268"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-269"></span><span class="hs-comment">-- {\-\# OPTIONS_GHC -fplugin GHC.TypeLits.Normalise \#-\}</span><span>
</span><span id="line-270"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-271"></span><span class="hs-comment">--</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- To the header of your file.</span><span>
</span><span id="line-273"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier hs-type">plugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Plugin</span></span><span>
</span><span id="line-274"></span><span id="plugin"><span class="annot"><span class="annottext">plugin :: Plugin
</span><a href="GHC.TypeLits.Normalise.html#plugin"><span class="hs-identifier hs-var hs-var">plugin</span></a></span></span><span>
</span><span id="line-275"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
</span><span class="hs-identifier hs-var">defaultPlugin</span></span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcPlugin :: TcPlugin
</span><span class="hs-identifier hs-var">tcPlugin</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Opts -&gt; Opts] -&gt; TcPlugin)
-&gt; Maybe [Opts -&gt; Opts] -&gt; Maybe TcPlugin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; TcPlugin
</span><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-var">normalisePlugin</span></a></span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; TcPlugin)
-&gt; ([Opts -&gt; Opts] -&gt; Opts) -&gt; [Opts -&gt; Opts] -&gt; TcPlugin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((Opts -&gt; Opts) -&gt; Opts -&gt; Opts) -&gt; Opts -&gt; [Opts -&gt; Opts] -&gt; Opts
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; Opts) -&gt; Opts -&gt; Opts
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">id</span></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115521"><span class="hs-identifier hs-var">defaultOpts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe [Opts -&gt; Opts] -&gt; Maybe TcPlugin)
-&gt; ([[Char]] -&gt; Maybe [Opts -&gt; Opts]) -&gt; TcPlugin
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe (Opts -&gt; Opts))
-&gt; [[Char]] -&gt; Maybe [Opts -&gt; Opts]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><span class="hs-identifier hs-var">traverse</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; Maybe (Opts -&gt; Opts)
</span><a href="#local-6989586621679115519"><span class="hs-identifier hs-var">parseArgument</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,6,0)
</span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">pluginRecompile :: [[Char]] -&gt; IO PluginRecompile
</span><span class="hs-identifier hs-var">pluginRecompile</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[Char]] -&gt; IO PluginRecompile
</span><span class="hs-identifier hs-var">purePlugin</span></span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>  </span><span id="local-6989586621679115519"><span class="annot"><span class="annottext">parseArgument :: [Char] -&gt; Maybe (Opts -&gt; Opts)
</span><a href="#local-6989586621679115519"><span class="hs-identifier hs-var hs-var">parseArgument</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;allow-negated-numbers&quot;</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; Opts) -&gt; Maybe (Opts -&gt; Opts)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679115517"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115517"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115517"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">negNumbers :: Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>  </span><span class="annot"><a href="#local-6989586621679115519"><span class="hs-identifier hs-var">parseArgument</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; Maybe Word
forall a. Read a =&gt; [Char] -&gt; Maybe a
</span><span class="hs-identifier hs-var">readMaybe</span></span><span> </span><span class="annot"><span class="annottext">([Char] -&gt; Maybe Word)
-&gt; ([Char] -&gt; Maybe [Char]) -&gt; [Char] -&gt; Maybe Word
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; (a -&gt; m b) -&gt; a -&gt; m c
</span><span class="hs-operator hs-var">&lt;=&lt;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; Maybe [Char]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Maybe [a]
</span><span class="hs-identifier hs-var">stripPrefix</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;depth=&quot;</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679115515"><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679115515"><span class="hs-identifier hs-var">depth</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Opts -&gt; Opts) -&gt; Maybe (Opts -&gt; Opts)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679115514"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115514"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115514"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Word
depth :: Word
depth :: Word
</span><a href="GHC.TypeLits.Normalise.html#depth"><span class="hs-identifier hs-var hs-var">depth</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><a href="#local-6989586621679115519"><span class="hs-identifier hs-var">parseArgument</span></a></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Opts -&gt; Opts)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-285"></span><span>  </span><span id="local-6989586621679115521"><span class="annot"><span class="annottext">defaultOpts :: Opts
</span><a href="#local-6989586621679115521"><span class="hs-identifier hs-var hs-var">defaultOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Opts :: Bool -&gt; Word -&gt; Opts
</span><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">negNumbers :: Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">depth :: Word
</span><a href="GHC.TypeLits.Normalise.html#depth"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Word
</span><span class="hs-number">5</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>
</span><span id="line-287"></span><span class="hs-keyword">data</span><span> </span><span id="Opts"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-var">Opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Opts"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-var">Opts</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="negNumbers"><span class="annot"><span class="annottext">Opts -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var hs-var">negNumbers</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span id="depth"><span class="annot"><span class="annottext">Opts -&gt; Word
</span><a href="GHC.TypeLits.Normalise.html#depth"><span class="hs-identifier hs-var hs-var">depth</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-type">normalisePlugin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPlugin</span></span><span>
</span><span id="line-290"></span><span id="normalisePlugin"><span class="annot"><span class="annottext">normalisePlugin :: Opts -&gt; TcPlugin
</span><a href="GHC.TypeLits.Normalise.html#normalisePlugin"><span class="hs-identifier hs-var hs-var">normalisePlugin</span></a></span></span><span> </span><span id="local-6989586621679115511"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115511"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; TcPlugin -&gt; TcPlugin
</span><span class="hs-identifier hs-var">tracePlugin</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span>
</span><span id="line-291"></span><span>  </span><span class="annot"><span class="annottext">TcPlugin :: forall s.
TcPluginM s
-&gt; (s -&gt; TcPluginSolver) -&gt; (s -&gt; TcPluginM ()) -&gt; TcPlugin
</span><span class="hs-identifier hs-type">TcPlugin</span></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcPluginInit :: TcPluginM (IORef (Set CType))
</span><span class="hs-identifier hs-var">tcPluginInit</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (IORef (Set CType)) -&gt; TcPluginM (IORef (Set CType))
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (IORef (Set CType)) -&gt; TcPluginM (IORef (Set CType)))
-&gt; IO (IORef (Set CType)) -&gt; TcPluginM (IORef (Set CType))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set CType -&gt; IO (IORef (Set CType))
forall a. a -&gt; IO (IORef a)
</span><span class="hs-identifier hs-var">newIORef</span></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginSolve :: IORef (Set CType) -&gt; TcPluginSolver
</span><span class="hs-identifier hs-var">tcPluginSolve</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Opts -&gt; IORef (Set CType) -&gt; TcPluginSolver
</span><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var">decideEqualSOP</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115511"><span class="hs-identifier hs-var">opts</span></a></span><span>
</span><span id="line-293"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcPluginStop :: IORef (Set CType) -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginStop</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcPluginM () -&gt; IORef (Set CType) -&gt; TcPluginM ()
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcPluginM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span class="hs-keyword">newtype</span><span> </span><span id="OrigCt"><span class="annot"><a href="GHC.TypeLits.Normalise.html#OrigCt"><span class="hs-identifier hs-var">OrigCt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="OrigCt"><span class="annot"><a href="GHC.TypeLits.Normalise.html#OrigCt"><span class="hs-identifier hs-var">OrigCt</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="runOrigCt"><span class="annot"><span class="annottext">OrigCt -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#runOrigCt"><span class="hs-identifier hs-var hs-var">runOrigCt</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-type">decideEqualSOP</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span>
</span><span id="line-299"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IORef</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- ^ Givens that is already generated.</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-comment">--   We have to generate new givens at most once;</span><span>
</span><span id="line-302"></span><span>      </span><span class="hs-comment">--   otherwise GHC will loop indefinitely.</span><span>
</span><span id="line-303"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-304"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-305"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginResult</span></span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-comment">-- Simplification phase: Derives /simplified/ givens;</span><span>
</span><span id="line-309"></span><span class="hs-comment">-- we can reduce given constraints like @Show (Foo (n + 2))@</span><span>
</span><span id="line-310"></span><span class="hs-comment">-- to its normal form @Show (Foo (2 + n))@, which is eventually</span><span>
</span><span id="line-311"></span><span class="hs-comment">-- useful in solving phase.</span><span>
</span><span id="line-312"></span><span class="hs-comment">--</span><span>
</span><span id="line-313"></span><span class="hs-comment">-- This helps us to solve /indirect/ constraints;</span><span>
</span><span id="line-314"></span><span class="hs-comment">-- without this phase, we cannot derive, e.g.,</span><span>
</span><span id="line-315"></span><span class="hs-comment">-- @IsVector UVector (Fin (n + 1))@ from</span><span>
</span><span id="line-316"></span><span class="hs-comment">-- @Unbox (1 + n)@!</span><span>
</span><span id="line-317"></span><span id="decideEqualSOP"><span class="annot"><span class="annottext">decideEqualSOP :: Opts -&gt; IORef (Set CType) -&gt; TcPluginSolver
</span><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var hs-var">decideEqualSOP</span></a></span></span><span> </span><span id="local-6989586621679115501"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115501"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679115500"><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115500"><span class="hs-identifier hs-var">gen'd</span></a></span></span><span> </span><span id="local-6989586621679115499"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115499"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621679115498"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115498"><span class="hs-identifier hs-var">_deriveds</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679115497"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115497"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set CType) -&gt; TcPluginM (Set CType)
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set CType) -&gt; TcPluginM (Set CType))
-&gt; IO (Set CType) -&gt; TcPluginM (Set CType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; IO (Set CType)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115500"><span class="hs-identifier hs-var">gen'd</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,4,0)
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115495"><span class="annot"><span class="annottext">simplGivens :: [Ct]
</span><a href="#local-6989586621679115495"><span class="hs-identifier hs-var hs-var">simplGivens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct]
</span><span class="hs-identifier hs-var">flattenGivens</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115499"><span class="hs-identifier hs-var">givens</span></a></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">simplGivens</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">zonkCt</span><span> </span><span class="hs-identifier">givens</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115494"><span class="annot"><span class="annottext">reds :: [(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115494"><span class="hs-identifier hs-var hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>          </span><span class="annot"><span class="annottext">((Ct, (PredType, EvTerm, [PredType])) -&gt; Bool)
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679115493"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115493"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PredType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115493"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#negNumbers"><span class="hs-identifier hs-var hs-var">negNumbers</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115501"><span class="hs-identifier hs-var">opts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Ct, (PredType, EvTerm, [PredType]))]
 -&gt; [(Ct, (PredType, EvTerm, [PredType]))])
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-326"></span><span>          </span><span class="annot"><span class="annottext">Opts -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var">reduceGivens</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115501"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115497"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115495"><span class="hs-identifier hs-var">simplGivens</span></a></span><span>
</span><span id="line-327"></span><span>        </span><span id="local-6989586621679115490"><span class="annot"><span class="annottext">newlyDone :: [CType]
</span><a href="#local-6989586621679115490"><span class="hs-identifier hs-var hs-var">newlyDone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ct, (PredType, EvTerm, [PredType])) -&gt; CType)
-&gt; [(Ct, (PredType, EvTerm, [PredType]))] -&gt; [CType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679115489"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115489"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115489"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115494"><span class="hs-identifier hs-var">reds</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; TcPluginM ()
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcPluginM ()) -&gt; IO () -&gt; TcPluginM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-329"></span><span>      </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; (Set CType -&gt; Set CType) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115500"><span class="hs-identifier hs-var">gen'd</span></a></span><span> </span><span class="annot"><span class="annottext">((Set CType -&gt; Set CType) -&gt; IO ())
-&gt; (Set CType -&gt; Set CType) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set CType -&gt; Set CType -&gt; Set CType
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CType] -&gt; Set CType
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">fromList</span></span><span> </span><span class="annot"><span class="annottext">[CType]
</span><a href="#local-6989586621679115490"><span class="hs-identifier hs-var">newlyDone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-330"></span><span>    </span><span id="local-6989586621679115486"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115486"><span class="hs-identifier hs-var">newGivens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
-&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115494"><span class="hs-identifier hs-var">reds</span></a></span><span> </span><span class="annot"><span class="annottext">(((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
 -&gt; TcPluginM [Ct])
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
-&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679115485"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115485"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115484"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115484"><span class="hs-identifier hs-var">pred'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115483"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115483"><span class="hs-identifier hs-var">evTerm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-331"></span><span>      </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115485"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; PredType -&gt; EvTerm -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115485"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115484"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115483"><span class="hs-identifier hs-var">evTerm</span></a></span><span>
</span><span id="line-332"></span><span>    </span><span class="annot"><span class="annottext">TcPluginResult -&gt; TcPluginM TcPluginResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EvTerm, Ct)] -&gt; [Ct] -&gt; TcPluginResult
</span><span class="hs-identifier hs-var">TcPluginOk</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115486"><span class="hs-identifier hs-var">newGivens</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>
</span><span id="line-334"></span><span class="hs-comment">-- Solving phase.</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- Solves in/equalities on Nats and simplifiable constraints</span><span>
</span><span id="line-336"></span><span class="hs-comment">-- containing naturals.</span><span>
</span><span id="line-337"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#decideEqualSOP"><span class="hs-identifier hs-var">decideEqualSOP</span></a></span><span> </span><span id="local-6989586621679115479"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115479"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679115478"><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115478"><span class="hs-identifier hs-var">gen'd</span></a></span></span><span> </span><span id="local-6989586621679115477"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115477"><span class="hs-identifier hs-var">givens</span></a></span></span><span>  </span><span id="local-6989586621679115476"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115476"><span class="hs-identifier hs-var">_deriveds</span></a></span></span><span> </span><span id="local-6989586621679115475"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115475"><span class="hs-identifier hs-var">wanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-comment">-- GHC 7.10.1 puts deriveds with the wanteds, so filter them out</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,4,0)
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115474"><span class="annot"><span class="annottext">simplGivens :: [Ct]
</span><a href="#local-6989586621679115474"><span class="hs-identifier hs-var hs-var">simplGivens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115477"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct]
</span><span class="hs-identifier hs-var">flattenGivens</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115477"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621679115473"><span class="annot"><span class="annottext">subst :: [(TcTyVar, PredType)]
</span><a href="#local-6989586621679115473"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([(TcTyVar, PredType)], [Ct]) -&gt; [(TcTyVar, PredType)]
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(([(TcTyVar, PredType)], [Ct]) -&gt; [(TcTyVar, PredType)])
-&gt; ([(TcTyVar, PredType)], [Ct]) -&gt; [(TcTyVar, PredType)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((TcTyVar, PredType), Ct)] -&gt; ([(TcTyVar, PredType)], [Ct])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([((TcTyVar, PredType), Ct)] -&gt; ([(TcTyVar, PredType)], [Ct]))
-&gt; [((TcTyVar, PredType), Ct)] -&gt; ([(TcTyVar, PredType)], [Ct])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [((TcTyVar, PredType), Ct)]
</span><span class="hs-identifier hs-var">TcPluginM.mkSubst'</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115477"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-342"></span><span>        </span><span id="local-6989586621679115470"><span class="annot"><span class="annottext">wanteds0 :: [(OrigCt, Ct)]
</span><a href="#local-6989586621679115470"><span class="hs-identifier hs-var hs-var">wanteds0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; (OrigCt, Ct)) -&gt; [Ct] -&gt; [(OrigCt, Ct)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679115469"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115469"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; OrigCt
</span><a href="GHC.TypeLits.Normalise.html#OrigCt"><span class="hs-identifier hs-var">OrigCt</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115469"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-343"></span><span>                                </span><span class="annot"><span class="annottext">[(TcTyVar, PredType)] -&gt; Ct -&gt; Ct
</span><span class="hs-identifier hs-var">TcPluginM.substCt</span></span><span> </span><span class="annot"><span class="annottext">[(TcTyVar, PredType)]
</span><a href="#local-6989586621679115473"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115469"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-344"></span><span>                                </span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>                       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115475"><span class="hs-identifier hs-var">wanteds</span></a></span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">wanteds0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">ct</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">OrigCt</span><span> </span><span class="hs-identifier">ct</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ct</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">wanteds</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-identifier">simplGivens</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">zonkCt</span><span> </span><span class="hs-identifier">givens</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115467"><span class="annot"><span class="annottext">wanteds' :: [Ct]
</span><a href="#local-6989586621679115467"><span class="hs-identifier hs-var hs-var">wanteds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; [Ct]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isWanted</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Bool) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115475"><span class="hs-identifier hs-var">wanteds</span></a></span><span>
</span><span id="line-351"></span><span>        </span><span id="local-6989586621679115466"><span class="annot"><span class="annottext">unit_wanteds :: [(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115466"><span class="hs-identifier hs-var hs-var">unit_wanteds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct
 -&gt; Maybe
      (Either NatEquality NatInEquality, [(PredType, PredType)]))
-&gt; [Ct]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var">toNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115467"><span class="hs-identifier hs-var">wanteds'</span></a></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621679115464"><span class="annot"><span class="annottext">nonEqs :: [(OrigCt, Ct)]
</span><a href="#local-6989586621679115464"><span class="hs-identifier hs-var hs-var">nonEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((OrigCt, Ct) -&gt; Bool) -&gt; [(OrigCt, Ct)] -&gt; [(OrigCt, Ct)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; ((OrigCt, Ct) -&gt; Bool) -&gt; (OrigCt, Ct) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679115462"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115462"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPred</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115462"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPrimPred</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115462"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; Bool)
-&gt; ((OrigCt, Ct) -&gt; PredType) -&gt; (OrigCt, Ct) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType)
-&gt; ((OrigCt, Ct) -&gt; CtEvidence) -&gt; (OrigCt, Ct) -&gt; PredType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="annot"><span class="annottext">(Ct -&gt; CtEvidence)
-&gt; ((OrigCt, Ct) -&gt; Ct) -&gt; (OrigCt, Ct) -&gt; CtEvidence
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(OrigCt, Ct) -&gt; Ct
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span>
</span><span id="line-353"></span><span>                 </span><span class="annot"><span class="annottext">([(OrigCt, Ct)] -&gt; [(OrigCt, Ct)])
-&gt; [(OrigCt, Ct)] -&gt; [(OrigCt, Ct)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((OrigCt, Ct) -&gt; Bool) -&gt; [(OrigCt, Ct)] -&gt; [(OrigCt, Ct)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isWanted</span></span><span class="annot"><span class="annottext">(CtEvidence -&gt; Bool)
-&gt; ((OrigCt, Ct) -&gt; CtEvidence) -&gt; (OrigCt, Ct) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="annot"><span class="annottext">(Ct -&gt; CtEvidence)
-&gt; ((OrigCt, Ct) -&gt; Ct) -&gt; (OrigCt, Ct) -&gt; CtEvidence
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">(OrigCt, Ct) -&gt; Ct
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(OrigCt, Ct)]
</span><a href="#local-6989586621679115470"><span class="hs-identifier hs-var">wanteds0</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span id="local-6989586621679115461"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115461"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Set CType) -&gt; TcPluginM (Set CType)
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Set CType) -&gt; TcPluginM (Set CType))
-&gt; IO (Set CType) -&gt; TcPluginM (Set CType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; IO (Set CType)
forall a. IORef a -&gt; IO a
</span><span class="hs-identifier hs-var">readIORef</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115478"><span class="hs-identifier hs-var">gen'd</span></a></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115460"><span class="annot"><span class="annottext">redGs :: [(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115460"><span class="hs-identifier hs-var hs-var">redGs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Opts -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var">reduceGivens</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115479"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115461"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115474"><span class="hs-identifier hs-var">simplGivens</span></a></span><span>
</span><span id="line-356"></span><span>        </span><span id="local-6989586621679115459"><span class="annot"><span class="annottext">newlyDone :: [CType]
</span><a href="#local-6989586621679115459"><span class="hs-identifier hs-var hs-var">newlyDone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Ct, (PredType, EvTerm, [PredType])) -&gt; CType)
-&gt; [(Ct, (PredType, EvTerm, [PredType]))] -&gt; [CType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679115458"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115458"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115458"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115460"><span class="hs-identifier hs-var">redGs</span></a></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679115457"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115457"><span class="hs-identifier hs-var">redGivens</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
-&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115460"><span class="hs-identifier hs-var">redGs</span></a></span><span> </span><span class="annot"><span class="annottext">(((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
 -&gt; TcPluginM [Ct])
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM Ct)
-&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679115456"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115456"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115455"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115455"><span class="hs-identifier hs-var">pred'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115454"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115454"><span class="hs-identifier hs-var">evTerm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>      </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115456"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; PredType -&gt; EvTerm -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115456"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115455"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115454"><span class="hs-identifier hs-var">evTerm</span></a></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621679115453"><span class="annot"><span class="annottext">[(Ct, (EvTerm, [(PredType, PredType)]))]
</span><a href="#local-6989586621679115453"><span class="hs-identifier hs-var">reducible_wanteds</span></a></span></span><span>
</span><span id="line-360"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe (Ct, (EvTerm, [(PredType, PredType)]))]
-&gt; [(Ct, (EvTerm, [(PredType, PredType)]))]
forall a. [Maybe a] -&gt; [a]
</span><span class="hs-identifier hs-var">catMaybes</span></span><span> </span><span class="annot"><span class="annottext">([Maybe (Ct, (EvTerm, [(PredType, PredType)]))]
 -&gt; [(Ct, (EvTerm, [(PredType, PredType)]))])
-&gt; TcPluginM [Maybe (Ct, (EvTerm, [(PredType, PredType)]))]
-&gt; TcPluginM [(Ct, (EvTerm, [(PredType, PredType)]))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-361"></span><span>            </span><span class="annot"><span class="annottext">((OrigCt, Ct)
 -&gt; TcPluginM (Maybe (Ct, (EvTerm, [(PredType, PredType)]))))
-&gt; [(OrigCt, Ct)]
-&gt; TcPluginM [Maybe (Ct, (EvTerm, [(PredType, PredType)]))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span>
</span><span id="line-362"></span><span>              </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679115451"><span class="annot"><span class="annottext">OrigCt
</span><a href="#local-6989586621679115451"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115450"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115450"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((EvTerm, [(PredType, PredType)])
 -&gt; (Ct, (EvTerm, [(PredType, PredType)])))
-&gt; Maybe (EvTerm, [(PredType, PredType)])
-&gt; Maybe (Ct, (EvTerm, [(PredType, PredType)]))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OrigCt -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#runOrigCt"><span class="hs-identifier hs-var hs-var">runOrigCt</span></a></span><span> </span><span class="annot"><span class="annottext">OrigCt
</span><a href="#local-6989586621679115451"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (EvTerm, [(PredType, PredType)])
 -&gt; Maybe (Ct, (EvTerm, [(PredType, PredType)])))
-&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
-&gt; TcPluginM (Maybe (Ct, (EvTerm, [(PredType, PredType)])))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-363"></span><span>                  </span><span class="annot"><span class="annottext">[Ct] -&gt; Ct -&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
</span><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-var">reduceNatConstr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115474"><span class="hs-identifier hs-var">simplGivens</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115457"><span class="hs-identifier hs-var">redGivens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115450"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-364"></span><span>              </span><span class="hs-special">)</span><span>
</span><span id="line-365"></span><span>            </span><span class="annot"><span class="annottext">[(OrigCt, Ct)]
</span><a href="#local-6989586621679115464"><span class="hs-identifier hs-var">nonEqs</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115466"><span class="hs-identifier hs-var">unit_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (EvTerm, [(PredType, PredType)]))] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (EvTerm, [(PredType, PredType)]))]
</span><a href="#local-6989586621679115453"><span class="hs-identifier hs-var">reducible_wanteds</span></a></span><span>
</span><span id="line-367"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TcPluginResult -&gt; TcPluginM TcPluginResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(TcPluginResult -&gt; TcPluginM TcPluginResult)
-&gt; TcPluginResult -&gt; TcPluginM TcPluginResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(EvTerm, Ct)] -&gt; [Ct] -&gt; TcPluginResult
</span><span class="hs-identifier hs-var">TcPluginOk</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>        </span><span class="hs-comment">-- Since reducible wanteds also can have some negation/subtraction</span><span>
</span><span id="line-370"></span><span>        </span><span class="hs-comment">-- subterms, we have to make sure appropriate inequalities to hold.</span><span>
</span><span id="line-371"></span><span>        </span><span class="hs-comment">-- Here, we generate such additional inequalities for reduction</span><span>
</span><span id="line-372"></span><span>        </span><span class="hs-comment">-- that is to be added to new [W]anteds.</span><span>
</span><span id="line-373"></span><span>        </span><span id="local-6989586621679115447"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115447"><span class="hs-identifier hs-var">ineqForRedWants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([[Ct]] -&gt; [Ct]) -&gt; TcPluginM [[Ct]] -&gt; TcPluginM [Ct]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">[[Ct]] -&gt; [Ct]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="annot"><span class="annottext">(TcPluginM [[Ct]] -&gt; TcPluginM [Ct])
-&gt; TcPluginM [[Ct]] -&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM [Ct])
-&gt; TcPluginM [[Ct]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="#local-6989586621679115460"><span class="hs-identifier hs-var">redGs</span></a></span><span> </span><span class="annot"><span class="annottext">(((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM [Ct])
 -&gt; TcPluginM [[Ct]])
-&gt; ((Ct, (PredType, EvTerm, [PredType])) -&gt; TcPluginM [Ct])
-&gt; TcPluginM [[Ct]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679115445"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115445"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115444"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115444"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[PredType] -&gt; (PredType -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115444"><span class="hs-identifier hs-var">ws</span></a></span><span> </span><span class="annot"><span class="annottext">((PredType -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct])
-&gt; (PredType -&gt; TcPluginM Ct) -&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-374"></span><span>          </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Ct) -&gt; TcPluginM CtEvidence -&gt; TcPluginM Ct
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115445"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcPluginM CtEvidence -&gt; TcPluginM Ct)
-&gt; (PredType -&gt; TcPluginM CtEvidence) -&gt; PredType -&gt; TcPluginM Ct
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; PredType -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">newWanted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115445"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; TcPluginM ()
forall a. IO a -&gt; TcPluginM a
</span><span class="hs-identifier hs-var">tcPluginIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcPluginM ()) -&gt; IO () -&gt; TcPluginM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-376"></span><span>          </span><span class="annot"><span class="annottext">IORef (Set CType) -&gt; (Set CType -&gt; Set CType) -&gt; IO ()
forall a. IORef a -&gt; (a -&gt; a) -&gt; IO ()
</span><span class="hs-identifier hs-var">modifyIORef'</span></span><span> </span><span class="annot"><span class="annottext">IORef (Set CType)
</span><a href="#local-6989586621679115478"><span class="hs-identifier hs-var">gen'd</span></a></span><span> </span><span class="annot"><span class="annottext">((Set CType -&gt; Set CType) -&gt; IO ())
-&gt; (Set CType -&gt; Set CType) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Set CType -&gt; Set CType -&gt; Set CType
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><span class="hs-identifier hs-var">union</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CType] -&gt; Set CType
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">fromList</span></span><span> </span><span class="annot"><span class="annottext">[CType]
</span><a href="#local-6989586621679115459"><span class="hs-identifier hs-var">newlyDone</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115443"><span class="annot"><span class="annottext">unit_givens :: [(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115443"><span class="hs-identifier hs-var hs-var">unit_givens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Ct
 -&gt; Maybe
      (Either NatEquality NatInEquality, [(PredType, PredType)]))
-&gt; [Ct]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var">toNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115474"><span class="hs-identifier hs-var">simplGivens</span></a></span><span>
</span><span id="line-378"></span><span>        </span><span id="local-6989586621679115442"><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679115442"><span class="hs-identifier hs-var">sr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Opts
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-var">simplifyNats</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115479"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115443"><span class="hs-identifier hs-var">unit_givens</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115466"><span class="hs-identifier hs-var">unit_wanteds</span></a></span><span>
</span><span id="line-379"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;normalised&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SimplifyResult -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679115442"><span class="hs-identifier hs-var">sr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-380"></span><span>        </span><span id="local-6989586621679115439"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115439"><span class="hs-identifier hs-var">reds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Ct, (EvTerm, [(PredType, PredType)]))]
-&gt; ((Ct, (EvTerm, [(PredType, PredType)]))
    -&gt; TcPluginM ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><span class="hs-identifier hs-var">forM</span></span><span> </span><span class="annot"><span class="annottext">[(Ct, (EvTerm, [(PredType, PredType)]))]
</span><a href="#local-6989586621679115453"><span class="hs-identifier hs-var">reducible_wanteds</span></a></span><span> </span><span class="annot"><span class="annottext">(((Ct, (EvTerm, [(PredType, PredType)]))
  -&gt; TcPluginM ((EvTerm, Ct), [Ct]))
 -&gt; TcPluginM [((EvTerm, Ct), [Ct])])
-&gt; ((Ct, (EvTerm, [(PredType, PredType)]))
    -&gt; TcPluginM ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679115438"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115438"><span class="hs-identifier hs-var">origCt</span></a></span></span><span class="hs-special">,</span><span class="hs-special">(</span><span id="local-6989586621679115437"><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115437"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115436"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115436"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>          </span><span id="local-6989586621679115435"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115435"><span class="hs-identifier hs-var">wants</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; [(PredType, PredType)] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var">evSubtPreds</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115438"><span class="hs-identifier hs-var">origCt</span></a></span><span> </span><span class="annot"><span class="annottext">([(PredType, PredType)] -&gt; TcPluginM [Ct])
-&gt; [(PredType, PredType)] -&gt; TcPluginM [Ct]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115479"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115436"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; TcPluginM ((EvTerm, Ct), [Ct])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115437"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115438"><span class="hs-identifier hs-var">origCt</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115435"><span class="hs-identifier hs-var">wants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679115442"><span class="hs-identifier hs-var">sr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-384"></span><span>          </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679115431"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115431"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-385"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115430"><span class="annot"><span class="annottext">simpld :: [((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115430"><span class="hs-identifier hs-var hs-var">simpld</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(((EvTerm, Ct), [Ct]) -&gt; Bool)
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isWanted</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; CtEvidence)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; CtEvidence)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Ct)
-&gt; ((EvTerm, Ct), [Ct])
-&gt; CtEvidence
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621679115429"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115429"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115429"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115431"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-386"></span><span>                </span><span class="hs-special">(</span><span id="local-6989586621679115428"><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621679115428"><span class="hs-identifier hs-var">solved'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115427"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115427"><span class="hs-identifier hs-var">newWanteds</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[Ct]] -&gt; [Ct])
-&gt; ([(EvTerm, Ct)], [[Ct]]) -&gt; ([(EvTerm, Ct)], [Ct])
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="annot"><span class="annottext">[[Ct]] -&gt; [Ct]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">unzip</span></span><span> </span><span class="annot"><span class="annottext">([((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]]))
-&gt; [((EvTerm, Ct), [Ct])] -&gt; ([(EvTerm, Ct)], [[Ct]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115430"><span class="hs-identifier hs-var">simpld</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115439"><span class="hs-identifier hs-var">reds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>            </span><span class="annot"><span class="annottext">TcPluginResult -&gt; TcPluginM TcPluginResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(EvTerm, Ct)] -&gt; [Ct] -&gt; TcPluginResult
</span><span class="hs-identifier hs-var">TcPluginOk</span></span><span> </span><span class="annot"><span class="annottext">[(EvTerm, Ct)]
</span><a href="#local-6989586621679115428"><span class="hs-identifier hs-var">solved'</span></a></span><span> </span><span class="annot"><span class="annottext">([Ct] -&gt; TcPluginResult) -&gt; [Ct] -&gt; TcPluginResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115427"><span class="hs-identifier hs-var">newWanteds</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115447"><span class="hs-identifier hs-var">ineqForRedWants</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>          </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679115425"><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115425"><span class="hs-identifier hs-var">eq</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcPluginResult -&gt; TcPluginM TcPluginResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Ct] -&gt; TcPluginResult
</span><span class="hs-identifier hs-var">TcPluginContradiction</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Either NatEquality NatInEquality -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var">fromNatEquality</span></a></span><span> </span><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115425"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-keyword">type</span><span> </span><span id="NatEquality"><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-var">NatEquality</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span class="hs-keyword">type</span><span> </span><span id="NatInEquality"><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-var">NatInEquality</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-type">reduceGivens</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span id="reduceGivens"><span class="annot"><span class="annottext">reduceGivens :: Opts -&gt; Set CType -&gt; [Ct] -&gt; [(Ct, (PredType, EvTerm, [PredType]))]
</span><a href="GHC.TypeLits.Normalise.html#reduceGivens"><span class="hs-identifier hs-var hs-var">reduceGivens</span></a></span></span><span> </span><span id="local-6989586621679115422"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115422"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679115421"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115421"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621679115420"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115420"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-395"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115419"><span class="annot"><span class="annottext">nonEqs :: [Ct]
</span><a href="#local-6989586621679115419"><span class="hs-identifier hs-var hs-var">nonEqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115418"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679115418"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115418"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115420"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115417"><span class="annot"><span class="annottext">ev :: CtEvidence
</span><a href="#local-6989586621679115417"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115418"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-399"></span><span>              </span><span id="local-6989586621679115416"><span class="annot"><span class="annottext">prd :: PredType
</span><a href="#local-6989586621679115416"><span class="hs-identifier hs-var hs-var">prd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115417"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115417"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679115415"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115415"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPred</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115415"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><span class="hs-identifier hs-var">isEqPrimPred</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115415"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="GHC.TypeLits.Normalise.html#isEqPredClass"><span class="hs-identifier hs-var">isEqPredClass</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115415"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115416"><span class="hs-identifier hs-var">prd</span></a></span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-403"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((Ct, (PredType, EvTerm, [PredType])) -&gt; Bool)
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span>
</span><span id="line-404"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115414"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115414"><span class="hs-identifier hs-var">prd</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-405"></span><span>        </span><span class="annot"><span class="annottext">CType -&gt; Set CType -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><span class="hs-identifier hs-var">notMember</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; CType
</span><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-var">CType</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115414"><span class="hs-identifier hs-var">prd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115421"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-406"></span><span>      </span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="annottext">([(Ct, (PredType, EvTerm, [PredType]))]
 -&gt; [(Ct, (PredType, EvTerm, [PredType]))])
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
-&gt; [(Ct, (PredType, EvTerm, [PredType]))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Maybe (Ct, (PredType, EvTerm, [PredType])))
-&gt; [Ct] -&gt; [(Ct, (PredType, EvTerm, [PredType]))]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span>
</span><span id="line-408"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679115413"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115413"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115413"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((PredType, EvTerm, [PredType])
 -&gt; (Ct, (PredType, EvTerm, [PredType])))
-&gt; Maybe (PredType, EvTerm, [PredType])
-&gt; Maybe (Ct, (PredType, EvTerm, [PredType]))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Opts -&gt; [Ct] -&gt; Ct -&gt; Maybe (PredType, EvTerm, [PredType])
</span><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-var">tryReduceGiven</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115422"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115420"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115413"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>      </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115419"><span class="hs-identifier hs-var">nonEqs</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-type">tryReduceGiven</span></a></span><span>
</span><span id="line-412"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-413"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="tryReduceGiven"><span class="annot"><span class="annottext">tryReduceGiven :: Opts -&gt; [Ct] -&gt; Ct -&gt; Maybe (PredType, EvTerm, [PredType])
</span><a href="GHC.TypeLits.Normalise.html#tryReduceGiven"><span class="hs-identifier hs-var hs-var">tryReduceGiven</span></a></span></span><span> </span><span id="local-6989586621679115411"><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115411"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span id="local-6989586621679115410"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115410"><span class="hs-identifier hs-var">simplGivens</span></a></span></span><span> </span><span id="local-6989586621679115409"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115409"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115408"><span class="annot"><span class="annottext">Maybe PredType
</span><a href="#local-6989586621679115408"><span class="hs-identifier hs-var">mans</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115407"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115407"><span class="hs-identifier hs-var">ws</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-416"></span><span>          </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] (Maybe PredType)
-&gt; (Maybe PredType, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer [(PredType, PredType)] (Maybe PredType)
 -&gt; (Maybe PredType, [(PredType, PredType)]))
-&gt; Writer [(PredType, PredType)] (Maybe PredType)
-&gt; (Maybe PredType, [(PredType, PredType)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] (Maybe PredType)
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNatEverywhere"><span class="hs-identifier hs-var">normaliseNatEverywhere</span></a></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; Writer [(PredType, PredType)] (Maybe PredType))
-&gt; PredType -&gt; Writer [(PredType, PredType)] (Maybe PredType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-417"></span><span>          </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; CtEvidence -&gt; PredType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115409"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-418"></span><span>        </span><span id="local-6989586621679115404"><span class="annot"><span class="annottext">ws' :: [PredType]
</span><a href="#local-6989586621679115404"><span class="hs-identifier hs-var hs-var">ws'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115403"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-419"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115403"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115403"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115411"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115407"><span class="hs-identifier hs-var">ws</span></a></span><span>
</span><span id="line-420"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (Ct -&gt; Bool) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115403"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(PredType -&gt; Bool) -&gt; (Ct -&gt; PredType) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; PredType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115410"><span class="hs-identifier hs-var">simplGivens</span></a></span><span>
</span><span id="line-421"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-422"></span><span>    </span><span id="local-6989586621679115401"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115401"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe PredType
</span><a href="#local-6989586621679115408"><span class="hs-identifier hs-var">mans</span></a></span><span>
</span><span id="line-423"></span><span>    </span><span class="annot"><span class="annottext">(PredType, EvTerm, [PredType])
-&gt; Maybe (PredType, EvTerm, [PredType])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115401"><span class="hs-identifier hs-var">pred'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType -&gt; EvTerm
</span><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-var">toReducedDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115409"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115401"><span class="hs-identifier hs-var">pred'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115404"><span class="hs-identifier hs-var">ws'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-type">fromNatEquality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-426"></span><span id="fromNatEquality"><span class="annot"><span class="annottext">fromNatEquality :: Either NatEquality NatInEquality -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var hs-var">fromNatEquality</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679115399"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115399"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115399"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-427"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#fromNatEquality"><span class="hs-identifier hs-var">fromNatEquality</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115398"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115398"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115398"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-type">reduceNatConstr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span id="reduceNatConstr"><span class="annot"><span class="annottext">reduceNatConstr :: [Ct] -&gt; Ct -&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
</span><a href="GHC.TypeLits.Normalise.html#reduceNatConstr"><span class="hs-identifier hs-var hs-var">reduceNatConstr</span></a></span></span><span> </span><span id="local-6989586621679115397"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115397"><span class="hs-identifier hs-var">givens</span></a></span></span><span> </span><span id="local-6989586621679115396"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115396"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-431"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115395"><span class="annot"><span class="annottext">pred0 :: PredType
</span><a href="#local-6989586621679115395"><span class="hs-identifier hs-var hs-var">pred0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; CtEvidence -&gt; PredType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115396"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-432"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679115394"><span class="annot"><span class="annottext">Maybe PredType
</span><a href="#local-6989586621679115394"><span class="hs-identifier hs-var">mans</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679115393"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115393"><span class="hs-identifier hs-var">tests</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] (Maybe PredType)
-&gt; (Maybe PredType, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="annot"><span class="annottext">(Writer [(PredType, PredType)] (Maybe PredType)
 -&gt; (Maybe PredType, [(PredType, PredType)]))
-&gt; Writer [(PredType, PredType)] (Maybe PredType)
-&gt; (Maybe PredType, [(PredType, PredType)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] (Maybe PredType)
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNatEverywhere"><span class="hs-identifier hs-var">normaliseNatEverywhere</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115395"><span class="hs-identifier hs-var">pred0</span></a></span><span>
</span><span id="line-433"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe PredType
</span><a href="#local-6989586621679115394"><span class="hs-identifier hs-var">mans</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-434"></span><span>    </span><span class="annot"><span class="annottext">Maybe PredType
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(PredType, PredType)])
-&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679115392"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115392"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-436"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool) -&gt; [Ct] -&gt; Maybe Ct
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><span class="hs-identifier hs-var">find</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115392"><span class="hs-identifier hs-var">pred'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; Bool) -&gt; (Ct -&gt; PredType) -&gt; Ct -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; (Ct -&gt; CtEvidence) -&gt; Ct -&gt; PredType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115397"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-437"></span><span>        </span><span class="annot"><span class="annottext">Maybe Ct
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(PredType, PredType)])
-&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-438"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679115391"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115391"><span class="hs-identifier hs-var">c</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (EvTerm, [(PredType, PredType)])
-&gt; TcPluginM (Maybe (EvTerm, [(PredType, PredType)]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EvTerm, [(PredType, PredType)])
-&gt; Maybe (EvTerm, [(PredType, PredType)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType -&gt; EvTerm
</span><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-var">toReducedDict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115391"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115395"><span class="hs-identifier hs-var">pred0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115393"><span class="hs-identifier hs-var">tests</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-type">toReducedDict</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtEvidence</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span>
</span><span id="line-441"></span><span id="toReducedDict"><span class="annot"><span class="annottext">toReducedDict :: CtEvidence -&gt; PredType -&gt; EvTerm
</span><a href="GHC.TypeLits.Normalise.html#toReducedDict"><span class="hs-identifier hs-var hs-var">toReducedDict</span></a></span></span><span> </span><span id="local-6989586621679115390"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115390"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621679115389"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115389"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-442"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115388"><span class="annot"><span class="annottext">pred0 :: PredType
</span><a href="#local-6989586621679115388"><span class="hs-identifier hs-var hs-var">pred0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115390"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-443"></span><span>      </span><span id="local-6989586621679115387"><span class="annot"><span class="annottext">evCo :: Coercion
</span><a href="#local-6989586621679115387"><span class="hs-identifier hs-var hs-var">evCo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; PredType -&gt; PredType -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>              </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Representational</span></span><span>
</span><span id="line-445"></span><span>              </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115388"><span class="hs-identifier hs-var">pred0</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115389"><span class="hs-identifier hs-var">pred'</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,6,0)
</span><span>      </span><span id="local-6989586621679115384"><span class="annot"><span class="annottext">ev :: EvTerm
</span><a href="#local-6989586621679115384"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; EvExpr
</span><span class="hs-identifier hs-var">ctEvExpr</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115390"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-448"></span><span>             </span><span class="annot"><span class="annottext">EvExpr -&gt; Coercion -&gt; EvTerm
</span><span class="hs-operator hs-var">`evCast`</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679115387"><span class="hs-identifier hs-var">evCo</span></a></span><span class="hs-cpp">
#else
</span><span>      </span><span class="hs-identifier">ev</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ctEvTerm</span><span> </span><span class="hs-identifier">ct</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">EvCast</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">evCo</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">EvTerm
</span><a href="#local-6989586621679115384"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-keyword">data</span><span> </span><span id="SimplifyResult"><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-var">SimplifyResult</span></a></span></span><span>
</span><span id="line-455"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="Simplified"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-456"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="Impossible"><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679115381"><span class="annot"><span class="hs-identifier hs-type">Outputable</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>  </span><span id="local-6989586621679115379"><span class="annot"><span class="annottext">ppr :: SimplifyResult -&gt; SDoc
</span><a href="#local-6989586621679115379"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679115378"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115378"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Simplified&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><span class="hs-operator hs-var">$$</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115378"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-460"></span><span>  </span><span class="annot"><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679115377"><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115377"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc
</span><span class="hs-identifier hs-var">text</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;Impossible&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Either NatEquality NatInEquality -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115377"><span class="hs-identifier hs-var">eq</span></a></span><span>
</span><span id="line-461"></span><span>
</span><span id="line-462"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-type">simplifyNats</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span>
</span><span id="line-464"></span><span>  </span><span class="hs-comment">-- ^ Allow negated numbers (potentially unsound!)</span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>  </span><span class="hs-comment">-- ^ Given constraints</span><span>
</span><span id="line-467"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-468"></span><span>  </span><span class="hs-comment">-- ^ Wanted constraints</span><span>
</span><span id="line-469"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span><span>
</span><span id="line-470"></span><span id="simplifyNats"><span class="annot"><span class="annottext">simplifyNats :: Opts
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#simplifyNats"><span class="hs-identifier hs-var hs-var">simplifyNats</span></a></span></span><span> </span><span id="local-6989586621679115376"><span class="annot"><span class="annottext">opts :: Opts
</span><a href="#local-6989586621679115376"><span class="hs-identifier hs-var">opts</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679115374"><span id="local-6989586621679115375"><span class="annot"><span class="annottext">Bool
Word
depth :: Word
negNumbers :: Bool
depth :: Opts -&gt; Word
negNumbers :: Opts -&gt; Bool
</span><a href="#local-6989586621679115374"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679115373"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115373"><span class="hs-identifier hs-var">eqsG</span></a></span></span><span> </span><span id="local-6989586621679115372"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115372"><span class="hs-identifier hs-var">eqsW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-471"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115371"><span class="annot"><span class="annottext">eqsG1 :: [(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115371"><span class="hs-identifier hs-var hs-var">eqsG1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either NatEquality NatInEquality, [(PredType, PredType)])
 -&gt; (Either NatEquality NatInEquality, [(PredType, PredType)]))
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([(PredType, PredType)] -&gt; [(PredType, PredType)])
-&gt; (Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; (Either NatEquality NatInEquality, [(PredType, PredType)])
forall (a :: * -&gt; * -&gt; *) b c d.
Arrow a =&gt;
a b c -&gt; a (d, b) (d, c)
</span><span class="hs-identifier hs-var">second</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115373"><span class="hs-identifier hs-var">eqsG</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679115370"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115370"><span class="hs-identifier hs-var">varEqs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115369"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115369"><span class="hs-identifier hs-var">otherEqs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either NatEquality NatInEquality, [(PredType, PredType)])
 -&gt; Bool)
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; ([(Either NatEquality NatInEquality, [(PredType, PredType)])],
    [(Either NatEquality NatInEquality, [(PredType, PredType)])])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><span class="hs-identifier hs-var">partition</span></span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)]) -&gt; Bool
forall a v c v c b b. (Either (a, SOP v c, SOP v c) b, b) -&gt; Bool
</span><a href="#local-6989586621679115368"><span class="hs-identifier hs-var">isVarEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115371"><span class="hs-identifier hs-var">eqsG1</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span id="local-6989586621679115367"><span class="annot"><span class="annottext">fancyGivens :: [[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
</span><a href="#local-6989586621679115367"><span class="hs-identifier hs-var hs-var">fancyGivens</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Either NatEquality NatInEquality, [(PredType, PredType)])
 -&gt; [[(Either NatEquality NatInEquality, [(PredType, PredType)])]])
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><span class="hs-identifier hs-var">concatMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; (Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; [[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
forall v a c c a c c c b.
Eq v =&gt;
[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115365"><span class="hs-identifier hs-var">makeGivensSet</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115369"><span class="hs-identifier hs-var">otherEqs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115370"><span class="hs-identifier hs-var">varEqs</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115370"><span class="hs-identifier hs-var">varEqs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-475"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115364"><span class="annot"><span class="annottext">eqs :: [(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115364"><span class="hs-identifier hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115369"><span class="hs-identifier hs-var">otherEqs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115372"><span class="hs-identifier hs-var">eqsW</span></a></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;simplifyNats&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115364"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115364"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-479"></span><span>      </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;simplifyNats(backtrack: &quot;</span></span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Char]
forall a. Show a =&gt; a -&gt; [Char]
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
-&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
</span><a href="#local-6989586621679115367"><span class="hs-identifier hs-var">fancyGivens</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; [Char] -&gt; [Char]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;)&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-481"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115370"><span class="hs-identifier hs-var">varEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="annottext">(SimplifyResult -&gt; SimplifyResult -&gt; SimplifyResult)
-&gt; SimplifyResult -&gt; [SimplifyResult] -&gt; SimplifyResult
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; SimplifyResult -&gt; SimplifyResult
</span><a href="#local-6989586621679115360"><span class="hs-identifier hs-var">findFirstSimpliedWanted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SimplifyResult] -&gt; SimplifyResult)
-&gt; TcPluginM [SimplifyResult] -&gt; TcPluginM SimplifyResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span>
</span><span id="line-483"></span><span>              </span><span class="annot"><span class="annottext">([(Either NatEquality NatInEquality, [(PredType, PredType)])]
 -&gt; TcPluginM SimplifyResult)
-&gt; [[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
-&gt; TcPluginM [SimplifyResult]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679115359"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115359"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115358"><span class="annot"><span class="annottext">eqs :: [(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115358"><span class="hs-identifier hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115359"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115372"><span class="hs-identifier hs-var">eqsW</span></a></span><span>
</span><span id="line-484"></span><span>                             </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;simplifyNats&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115358"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>                             </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115358"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>              </span><span class="annot"><span class="annottext">[[(Either NatEquality NatInEquality, [(PredType, PredType)])]]
</span><a href="#local-6989586621679115367"><span class="hs-identifier hs-var">fancyGivens</span></a></span><span>
</span><span id="line-487"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><a href="#local-6989586621679115363"><span class="hs-identifier hs-type">simples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreUnify"><span class="hs-identifier hs-type">CoreUnify</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-489"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-490"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreSOP"><span class="hs-identifier hs-type">CoreSOP</span></a></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-491"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-492"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-493"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#SimplifyResult"><span class="hs-identifier hs-type">SimplifyResult</span></a></span><span>
</span><span id="line-494"></span><span>    </span><span id="local-6989586621679115363"><span class="annot"><span class="annottext">simples :: [CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var hs-var">simples</span></a></span></span><span> </span><span id="local-6989586621679115357"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115357"><span class="hs-identifier hs-var">_subst</span></a></span></span><span> </span><span id="local-6989586621679115356"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115356"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679115355"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115355"><span class="hs-identifier hs-var">_leqsG</span></a></span></span><span> </span><span id="local-6989586621679115354"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115354"><span class="hs-identifier hs-var">_xs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115356"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span id="local-6989586621679115353"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679115352"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679115351"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115351"><span class="hs-identifier hs-var">leqsG</span></a></span></span><span> </span><span id="local-6989586621679115350"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115349"><span class="annot"><span class="annottext">eq :: (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115349"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115348"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115348"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115347"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115347"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115346"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115346"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679115345"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115345"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679115344"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-496"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115343"><span class="annot"><span class="annottext">u' :: CoreSOP
</span><a href="#local-6989586621679115343"><span class="hs-identifier hs-var hs-var">u'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115347"><span class="hs-identifier hs-var">u</span></a></span><span>
</span><span id="line-497"></span><span>          </span><span id="local-6989586621679115341"><span class="annot"><span class="annottext">v' :: CoreSOP
</span><a href="#local-6989586621679115341"><span class="hs-identifier hs-var hs-var">v'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115346"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-498"></span><span>      </span><span id="local-6989586621679115340"><span class="annot"><span class="annottext">UnifyResult
</span><a href="#local-6989586621679115340"><span class="hs-identifier hs-var">ur</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CoreSOP -&gt; CoreSOP -&gt; TcPluginM UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#unifyNats"><span class="hs-identifier hs-var">unifyNats</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115348"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115343"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115341"><span class="hs-identifier hs-var">v'</span></a></span><span>
</span><span id="line-499"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unifyNats result&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnifyResult -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="#local-6989586621679115340"><span class="hs-identifier hs-var">ur</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-500"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="#local-6989586621679115340"><span class="hs-identifier hs-var">ur</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#Win"><span class="hs-identifier hs-var">Win</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-502"></span><span>          </span><span id="local-6989586621679115337"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115337"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Set CType
-&gt; [(PredType, PredType)]
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115348"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115376"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115345"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>          </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115337"><span class="hs-identifier hs-var">evs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115351"><span class="hs-identifier hs-var">leqsG</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>        </span><span class="annot"><span class="annottext">UnifyResult
</span><a href="GHC.TypeLits.Normalise.Unify.html#Lose"><span class="hs-identifier hs-var">Lose</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-505"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either NatEquality NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Either NatEquality NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115349"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-506"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115351"><span class="hs-identifier hs-var">leqsG</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-507"></span><span>        </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#Draw"><span class="hs-identifier hs-type">Draw</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115349"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-508"></span><span>        </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#Draw"><span class="hs-identifier hs-type">Draw</span></a></span><span> </span><span id="local-6989586621679115332"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115332"><span class="hs-identifier hs-var">subst'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-509"></span><span>          </span><span id="local-6989586621679115331"><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679115331"><span class="hs-identifier hs-var">evM</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Set CType
-&gt; [(PredType, PredType)]
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115348"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
forall a. Set a
</span><span class="hs-identifier hs-var">empty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreUnify -&gt; (PredType, PredType))
-&gt; [CoreUnify] -&gt; [(PredType, PredType)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">CoreUnify -&gt; (PredType, PredType)
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-var">unifyItemToPredType</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115332"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-510"></span><span>                                   </span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115376"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115345"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115329"><span class="annot"><span class="annottext">leqsG' :: [(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115329"><span class="hs-identifier hs-var hs-var">leqsG'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115348"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; CoreSOP -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a. a -&gt; a -&gt; [(a, a, Bool)]
</span><a href="#local-6989586621679115328"><span class="hs-identifier hs-var">eqToLeq</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115343"><span class="hs-identifier hs-var">u'</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115341"><span class="hs-identifier hs-var">v'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115351"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-512"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115351"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679115331"><span class="hs-identifier hs-var">evM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-514"></span><span>            </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115329"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-515"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679115327"><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679115327"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-516"></span><span>              </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreUnify] -&gt; [CoreUnify] -&gt; [CoreUnify]
forall v c.
(Ord v, Ord c) =&gt;
[UnifyItem v c] -&gt; [UnifyItem v c] -&gt; [UnifyItem v c]
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSubst"><span class="hs-identifier hs-var">substsSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115332"><span class="hs-identifier hs-var">subst'</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115353"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; [CoreUnify] -&gt; [CoreUnify]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115332"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-517"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
</span><a href="#local-6989586621679115327"><span class="hs-identifier hs-var">ev</span></a></span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115352"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115329"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115350"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115344"><span class="hs-identifier hs-var">eqs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span id="local-6989586621679115325"><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621679115324"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span></span><span> </span><span id="local-6989586621679115323"><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span></span><span> </span><span id="local-6989586621679115322"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115322"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115321"><span class="annot"><span class="annottext">eq :: (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115321"><span class="hs-identifier hs-var">eq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115320"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115320"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115319"><span class="annot"><span class="annottext">u :: (CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115319"><span class="hs-identifier hs-var">u</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679115318"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115318"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115317"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115317"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115316"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679115316"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679115315"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115315"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679115314"><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115314"><span class="hs-identifier hs-var">eqs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-519"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115313"><span class="annot"><span class="annottext">u' :: CoreSOP
</span><a href="#local-6989586621679115313"><span class="hs-identifier hs-var hs-var">u'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool) -&gt; CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#subtractIneq"><span class="hs-identifier hs-var">subtractIneq</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115319"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-520"></span><span>          </span><span id="local-6989586621679115311"><span class="annot"><span class="annottext">x' :: CoreSOP
</span><a href="#local-6989586621679115311"><span class="hs-identifier hs-var hs-var">x'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115318"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-521"></span><span>          </span><span id="local-6989586621679115310"><span class="annot"><span class="annottext">y' :: CoreSOP
</span><a href="#local-6989586621679115310"><span class="hs-identifier hs-var hs-var">y'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CoreUnify] -&gt; CoreSOP -&gt; CoreSOP
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115317"><span class="hs-identifier hs-var">y</span></a></span><span>
</span><span id="line-522"></span><span>          </span><span id="local-6989586621679115309"><span class="annot"><span class="annottext">uS :: (CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115309"><span class="hs-identifier hs-var hs-var">uS</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115311"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115310"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679115316"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-523"></span><span>          </span><span id="local-6989586621679115308"><span class="annot"><span class="annottext">leqsG' :: [(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115308"><span class="hs-identifier hs-var hs-var">leqsG'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; Bool
</span><span class="hs-identifier hs-var">isGiven</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115320"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115311"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115310"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679115316"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-524"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-525"></span><span>          </span><span id="local-6989586621679115307"><span class="annot"><span class="annottext">ineqs :: [(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115307"><span class="hs-identifier hs-var hs-var">ineqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[(CoreSOP, CoreSOP, Bool)]] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><span class="hs-identifier hs-var">concat</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-526"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; (CoreSOP, CoreSOP, Bool))
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[CoreUnify] -&gt; (CoreSOP, CoreSOP, Bool) -&gt; (CoreSOP, CoreSOP, Bool)
forall v c c.
(Ord v, Ord c) =&gt;
[UnifyItem v c] -&gt; (SOP v c, SOP v c, c) -&gt; (SOP v c, SOP v c, c)
</span><a href="#local-6989586621679115306"><span class="hs-identifier hs-var">substLeq</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span><span>
</span><span id="line-527"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(NatInEquality -&gt; (CoreSOP, CoreSOP, Bool))
-&gt; [NatInEquality] -&gt; [(CoreSOP, CoreSOP, Bool)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">NatInEquality -&gt; (CoreSOP, CoreSOP, Bool)
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either NatEquality NatInEquality] -&gt; [NatInEquality]
forall a b. [Either a b] -&gt; [b]
</span><span class="hs-identifier hs-var">rights</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Either NatEquality NatInEquality, [(PredType, PredType)])
 -&gt; Either NatEquality NatInEquality)
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [Either NatEquality NatInEquality]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Either NatEquality NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115373"><span class="hs-identifier hs-var">eqsG</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-529"></span><span>      </span><span class="annot"><span class="annottext">[Char] -&gt; SDoc -&gt; TcPluginM ()
</span><span class="hs-identifier hs-var">tcPluginTrace</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;unifyNats(ineq) results&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Ct, (CoreSOP, CoreSOP, Bool), CoreSOP, [(CoreSOP, CoreSOP, Bool)])
-&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><span class="hs-identifier hs-var">ppr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115320"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115319"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115313"><span class="hs-identifier hs-var">u'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115307"><span class="hs-identifier hs-var">ineqs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var hs-var">runWriterT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP -&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#isNatural"><span class="hs-identifier hs-var">isNatural</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115313"><span class="hs-identifier hs-var">u'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-531"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span id="local-6989586621679115303"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115303"><span class="hs-identifier hs-var">knW</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-532"></span><span>          </span><span id="local-6989586621679115302"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115302"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Set CType
-&gt; [(PredType, PredType)]
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115320"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115303"><span class="hs-identifier hs-var">knW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115376"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115315"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-533"></span><span>          </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115302"><span class="hs-identifier hs-var">evs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115308"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115322"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115314"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Set CType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115315"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SimplifyResult -&gt; TcPluginM SimplifyResult
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Either NatEquality NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Either NatEquality NatInEquality
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115321"><span class="hs-identifier hs-var">eq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>        </span><span class="annot"><span class="annottext">Maybe (Bool, Set CType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-537"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115301"><span class="annot"><span class="annottext">solvedIneq :: [(Bool, Set CType)]
</span><a href="#local-6989586621679115301"><span class="hs-identifier hs-var hs-var">solvedIneq</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType))
-&gt; [WriterT (Set CType) Maybe Bool] -&gt; [(Bool, Set CType)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">mapMaybe</span></span><span> </span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool -&gt; Maybe (Bool, Set CType)
forall w (m :: * -&gt; *) a. WriterT w m a -&gt; m (a, w)
</span><span class="hs-identifier hs-var hs-var">runWriterT</span></span><span>
</span><span id="line-538"></span><span>                 </span><span class="hs-comment">-- it is an inequality that can be instantly solved, such as</span><span>
</span><span id="line-539"></span><span>                 </span><span class="hs-comment">-- `1 &lt;= x^y`</span><span>
</span><span id="line-540"></span><span>                 </span><span class="hs-comment">-- OR</span><span>
</span><span id="line-541"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word -&gt; (CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#instantSolveIneq"><span class="hs-identifier hs-var">instantSolveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679115374"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115319"><span class="hs-identifier hs-var">u</span></a></span><span class="annot"><span class="annottext">WriterT (Set CType) Maybe Bool
-&gt; [WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-542"></span><span>                </span><span class="hs-comment">-- This inequality is either a given constraint, or it is a wanted</span><span>
</span><span id="line-543"></span><span>                </span><span class="hs-comment">-- constraint, which in normal form is equal to another given</span><span>
</span><span id="line-544"></span><span>                </span><span class="hs-comment">-- constraint, hence it can be solved.</span><span>
</span><span id="line-545"></span><span>                </span><span class="hs-comment">-- OR</span><span>
</span><span id="line-546"></span><span>                </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [WriterT (Set CType) Maybe Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#solveIneq"><span class="hs-identifier hs-var">solveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679115374"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115319"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115307"><span class="hs-identifier hs-var">ineqs</span></a></span><span> </span><span class="annot"><span class="annottext">[WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
-&gt; [WriterT (Set CType) Maybe Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span>
</span><span id="line-547"></span><span>                </span><span class="hs-comment">-- The above, but with valid substitutions applied to the wanted.</span><span>
</span><span id="line-548"></span><span>                </span><span class="annot"><span class="annottext">((CoreSOP, CoreSOP, Bool) -&gt; WriterT (Set CType) Maybe Bool)
-&gt; [(CoreSOP, CoreSOP, Bool)] -&gt; [WriterT (Set CType) Maybe Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; (CoreSOP, CoreSOP, Bool)
-&gt; WriterT (Set CType) Maybe Bool
</span><a href="GHC.TypeLits.Normalise.Unify.html#solveIneq"><span class="hs-identifier hs-var">solveIneq</span></a></span><span> </span><span class="annot"><span class="annottext">Word
</span><a href="#local-6989586621679115374"><span class="hs-identifier hs-var">depth</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreSOP, CoreSOP, Bool)
</span><a href="#local-6989586621679115309"><span class="hs-identifier hs-var">uS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115307"><span class="hs-identifier hs-var">ineqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>              </span><span id="local-6989586621679115298"><span class="annot"><span class="annottext">smallest :: (Bool, Set CType)
</span><a href="#local-6989586621679115298"><span class="hs-identifier hs-var hs-var">smallest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Bool, Set CType)] -&gt; (Bool, Set CType)
forall a. [(Bool, Set a)] -&gt; (Bool, Set a)
</span><a href="GHC.TypeLits.Normalise.Unify.html#solvedInEqSmallestConstraint"><span class="hs-identifier hs-var">solvedInEqSmallestConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">[(Bool, Set CType)]
</span><a href="#local-6989586621679115301"><span class="hs-identifier hs-var">solvedIneq</span></a></span><span>
</span><span id="line-550"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Bool, Set CType)
</span><a href="#local-6989586621679115298"><span class="hs-identifier hs-var">smallest</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-551"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span id="local-6989586621679115296"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115296"><span class="hs-identifier hs-var">kW</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-552"></span><span>              </span><span id="local-6989586621679115295"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115295"><span class="hs-identifier hs-var">evs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
-&gt; (((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; Maybe ((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct])
-&gt; [((EvTerm, Ct), [Ct])] -&gt; [((EvTerm, Ct), [Ct])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ((EvTerm, Ct), [Ct]) -&gt; [((EvTerm, Ct), [Ct])])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
-&gt; TcPluginM [((EvTerm, Ct), [Ct])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Ct
-&gt; Set CType
-&gt; [(PredType, PredType)]
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var">evMagic</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115320"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115296"><span class="hs-identifier hs-var">kW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var">subToPred</span></a></span><span> </span><span class="annot"><span class="annottext">Opts
</span><a href="#local-6989586621679115376"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115315"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-553"></span><span>              </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115295"><span class="hs-identifier hs-var">evs'</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115308"><span class="hs-identifier hs-var">leqsG'</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115322"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115314"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-554"></span><span>            </span><span class="annot"><span class="annottext">(Bool, Set CType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
-&gt; [((EvTerm, Ct), [Ct])]
-&gt; [(CoreSOP, CoreSOP, Bool)]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; TcPluginM SimplifyResult
</span><a href="#local-6989586621679115363"><span class="hs-identifier hs-var">simples</span></a></span><span> </span><span class="annot"><span class="annottext">[CoreUnify]
</span><a href="#local-6989586621679115325"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115324"><span class="hs-identifier hs-var">evs</span></a></span><span> </span><span class="annot"><span class="annottext">[(CoreSOP, CoreSOP, Bool)]
</span><a href="#local-6989586621679115323"><span class="hs-identifier hs-var">leqsG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115321"><span class="hs-identifier hs-var">eq</span></a></span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
-&gt; [(Either NatEquality NatInEquality, [(PredType, PredType)])]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115322"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either NatEquality NatInEquality, [(PredType, PredType)])]
</span><a href="#local-6989586621679115314"><span class="hs-identifier hs-var">eqs'</span></a></span><span>
</span><span id="line-555"></span><span>
</span><span id="line-556"></span><span>    </span><span id="local-6989586621679115328"><span class="annot"><span class="annottext">eqToLeq :: a -&gt; a -&gt; [(a, a, Bool)]
</span><a href="#local-6989586621679115328"><span class="hs-identifier hs-var hs-var">eqToLeq</span></a></span></span><span> </span><span id="local-6989586621679115294"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115294"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679115293"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115293"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115294"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115293"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115293"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115294"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-557"></span><span>    </span><span id="local-6989586621679115306"><span class="annot"><span class="annottext">substLeq :: [UnifyItem v c] -&gt; (SOP v c, SOP v c, c) -&gt; (SOP v c, SOP v c, c)
</span><a href="#local-6989586621679115306"><span class="hs-identifier hs-var hs-var">substLeq</span></a></span></span><span> </span><span id="local-6989586621679115292"><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679115292"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115291"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679115291"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115290"><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679115290"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115289"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679115289"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679115292"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679115291"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
forall v c. (Ord v, Ord c) =&gt; [UnifyItem v c] -&gt; SOP v c -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.Unify.html#substsSOP"><span class="hs-identifier hs-var">substsSOP</span></a></span><span> </span><span class="annot"><span class="annottext">[UnifyItem v c]
</span><a href="#local-6989586621679115292"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SOP v c
</span><a href="#local-6989586621679115290"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679115289"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>
</span><span id="line-559"></span><span>    </span><span id="local-6989586621679115368"><span class="annot"><span class="annottext">isVarEqs :: (Either (a, SOP v c, SOP v c) b, b) -&gt; Bool
</span><a href="#local-6989586621679115368"><span class="hs-identifier hs-var hs-var">isVarEqs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><span class="hs-identifier">_</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-560"></span><span>    </span><span class="annot"><a href="#local-6989586621679115368"><span class="hs-identifier hs-var">isVarEqs</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>    </span><span id="local-6989586621679115365"><span class="annot"><span class="annottext">makeGivensSet :: [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115365"><span class="hs-identifier hs-var hs-var">makeGivensSet</span></a></span></span><span> </span><span id="local-6989586621679115285"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115285"><span class="hs-identifier hs-var">otherEqs</span></a></span></span><span> </span><span id="local-6989586621679115284"><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679115284"><span class="hs-identifier hs-var">varEq</span></a></span></span><span>
</span><span id="line-563"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115283"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115283"><span class="hs-identifier hs-var">noMentionsV</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115282"><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115282"><span class="hs-identifier hs-var">mentionsV</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))]
-&gt; ([(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)],
    [Either
       (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
       (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span>
</span><span id="line-564"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
 -&gt; Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)))
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [Either
      (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
      (Either
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
         (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; Either
     (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
     (Either
        (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
        (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b))
forall a a c c b b a c c a c c c b.
Eq a =&gt;
(Either (a, SOP a c, SOP a c) b, b)
-&gt; (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
</span><a href="#local-6989586621679115281"><span class="hs-identifier hs-var">matchesVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679115284"><span class="hs-identifier hs-var">varEq</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115285"><span class="hs-identifier hs-var">otherEqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621679115280"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115280"><span class="hs-identifier hs-var">mentionsLHS</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115279"><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115279"><span class="hs-identifier hs-var">mentionsRHS</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; ([(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)],
    [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)])
forall a b. [Either a b] -&gt; ([a], [b])
</span><span class="hs-identifier hs-var">partitionEithers</span></span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115282"><span class="hs-identifier hs-var">mentionsV</span></a></span><span>
</span><span id="line-566"></span><span>            </span><span id="local-6989586621679115278"><span class="annot"><span class="annottext">vS :: (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679115278"><span class="hs-identifier hs-var hs-var">vS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
forall a v c v c b b c c b.
(Either (a, SOP v c, SOP v c) b, b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679115277"><span class="hs-identifier hs-var">swapVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679115284"><span class="hs-identifier hs-var">varEq</span></a></span><span>
</span><span id="line-567"></span><span>            </span><span id="local-6989586621679115276"><span class="annot"><span class="annottext">givensLHS :: [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115276"><span class="hs-identifier hs-var hs-var">givensLHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115280"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-568"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-569"></span><span>              </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115280"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
</span><a href="#local-6989586621679115284"><span class="hs-identifier hs-var">varEq</span></a></span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115279"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115283"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-570"></span><span>            </span><span id="local-6989586621679115275"><span class="annot"><span class="annottext">givensRHS :: [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115275"><span class="hs-identifier hs-var hs-var">givensRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115279"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-571"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-572"></span><span>              </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115279"><span class="hs-identifier hs-var">mentionsRHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
forall c c b. (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679115278"><span class="hs-identifier hs-var">vS</span></a></span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115280"><span class="hs-identifier hs-var">mentionsLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
-&gt; [(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115283"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-573"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115282"><span class="hs-identifier hs-var">mentionsV</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-574"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><a href="#local-6989586621679115283"><span class="hs-identifier hs-var">noMentionsV</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-575"></span><span>              </span><span class="annot"><span class="annottext">[Either
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)
   (Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115276"><span class="hs-identifier hs-var">givensLHS</span></a></span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
-&gt; [[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[[(Either (a, SOP v c, SOP v c) (a, (SOP v c, SOP v c, c)), b)]]
</span><a href="#local-6989586621679115275"><span class="hs-identifier hs-var">givensRHS</span></a></span><span>
</span><span id="line-576"></span><span>
</span><span id="line-577"></span><span>    </span><span id="local-6989586621679115281"><span class="annot"><span class="annottext">matchesVarEq :: (Either (a, SOP a c, SOP a c) b, b)
-&gt; (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
</span><a href="#local-6989586621679115281"><span class="hs-identifier hs-var hs-var">matchesVarEq</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115274"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115274"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115273"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115273"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679115272"><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-578"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115271"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115271"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115274"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115271"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-580"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115273"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115271"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115270"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115270"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115274"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115270"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-583"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115273"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115270"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115269"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115269"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115274"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115269"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115273"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115269"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-587"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">SOP a c
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115268"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115268"><span class="hs-identifier hs-var">v3</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-588"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115274"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115268"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115273"><span class="hs-identifier hs-var">v2</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115268"><span class="hs-identifier hs-var">v3</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
  (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-590"></span><span>      </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><a href="#local-6989586621679115272"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><a href="#local-6989586621679115281"><span class="hs-identifier hs-var">matchesVarEq</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char]
-&gt; Either
     (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
     (Either
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b)
        (Either (a, SOP a c, SOP a c) (a, (SOP a c, SOP a c, c)), b))
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>    </span><span id="local-6989586621679115277"><span class="annot"><span class="annottext">swapVar :: (Either (a, SOP v c, SOP v c) b, b)
-&gt; (Either (a, SOP v c, SOP v c) b, b)
</span><a href="#local-6989586621679115277"><span class="hs-identifier hs-var hs-var">swapVar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115266"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115266"><span class="hs-identifier hs-var">ct</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115265"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679115265"><span class="hs-identifier hs-var">v1</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-type">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-type">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-type">V</span></a></span><span> </span><span id="local-6989586621679115264"><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679115264"><span class="hs-identifier hs-var">v2</span></a></span></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621679115263"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679115263"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-594"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(a, SOP v c, SOP v c) -&gt; Either (a, SOP v c, SOP v c) b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679115266"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v -&gt; Symbol v c
forall v c. v -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-var">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679115264"><span class="hs-identifier hs-var">v2</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Product v c] -&gt; SOP v c
forall v c. [Product v c] -&gt; SOP v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#S"><span class="hs-identifier hs-var">S</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[Symbol v c] -&gt; Product v c
forall v c. [Symbol v c] -&gt; Product v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#P"><span class="hs-identifier hs-var">P</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">v -&gt; Symbol v c
forall v c. v -&gt; Symbol v c
</span><a href="GHC.TypeLits.Normalise.SOP.html#V"><span class="hs-identifier hs-var">V</span></a></span><span> </span><span class="annot"><span class="annottext">v
</span><a href="#local-6989586621679115265"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679115263"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-595"></span><span>    </span><span class="annot"><a href="#local-6989586621679115277"><span class="hs-identifier hs-var">swapVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Either (a, SOP v c, SOP v c) b, b)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Char] -&gt; (Either (a, SOP v c, SOP v c) b, b)
forall a. HasCallStack =&gt; [Char] -&gt; a
</span><span class="hs-identifier hs-var">error</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;internal error&quot;</span></span><span>
</span><span id="line-596"></span><span>
</span><span id="line-597"></span><span>    </span><span id="local-6989586621679115360"><span class="annot"><span class="annottext">findFirstSimpliedWanted :: SimplifyResult -&gt; SimplifyResult -&gt; SimplifyResult
</span><a href="#local-6989586621679115360"><span class="hs-identifier hs-var hs-var">findFirstSimpliedWanted</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-type">Impossible</span></a></span><span> </span><span id="local-6989586621679115262"><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115262"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">SimplifyResult
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either NatEquality NatInEquality -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Impossible"><span class="hs-identifier hs-var">Impossible</span></a></span><span> </span><span class="annot"><span class="annottext">Either NatEquality NatInEquality
</span><a href="#local-6989586621679115262"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-598"></span><span>    </span><span class="annot"><a href="#local-6989586621679115360"><span class="hs-identifier hs-var">findFirstSimpliedWanted</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-type">Simplified</span></a></span><span> </span><span id="local-6989586621679115261"><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115261"><span class="hs-identifier hs-var">evs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679115260"><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679115260"><span class="hs-identifier hs-var">s2</span></a></span></span><span>
</span><span id="line-599"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(((EvTerm, Ct), [Ct]) -&gt; Bool) -&gt; [((EvTerm, Ct), [Ct])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; Bool
</span><span class="hs-identifier hs-var">isWantedCt</span></span><span> </span><span class="annot"><span class="annottext">(Ct -&gt; Bool)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; Ct) -&gt; ((EvTerm, Ct), [Ct]) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(EvTerm, Ct) -&gt; Ct
forall a b. (a, b) -&gt; b
</span><span class="hs-identifier hs-var">snd</span></span><span> </span><span class="annot"><span class="annottext">((EvTerm, Ct) -&gt; Ct)
-&gt; (((EvTerm, Ct), [Ct]) -&gt; (EvTerm, Ct))
-&gt; ((EvTerm, Ct), [Ct])
-&gt; Ct
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; (EvTerm, Ct)
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115261"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-600"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])] -&gt; SimplifyResult
</span><a href="GHC.TypeLits.Normalise.html#Simplified"><span class="hs-identifier hs-var">Simplified</span></a></span><span> </span><span class="annot"><span class="annottext">[((EvTerm, Ct), [Ct])]
</span><a href="#local-6989586621679115261"><span class="hs-identifier hs-var">evs</span></a></span><span>
</span><span id="line-601"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-602"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimplifyResult
</span><a href="#local-6989586621679115260"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="hs-comment">-- If we allow negated numbers we simply do not emit the inequalities</span><span>
</span><span id="line-605"></span><span class="hs-comment">-- derived from the subtractions that are converted to additions with a</span><span>
</span><span id="line-606"></span><span class="hs-comment">-- negated operand</span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-type">subToPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-608"></span><span id="subToPred"><span class="annot"><span class="annottext">subToPred :: Opts -&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
</span><a href="GHC.TypeLits.Normalise.html#subToPred"><span class="hs-identifier hs-var hs-var">subToPred</span></a></span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#Opts"><span class="hs-identifier hs-type">Opts</span></a></span><span class="hs-special">{</span><span id="local-6989586621679115257"><span id="local-6989586621679115258"><span class="annot"><span class="annottext">Bool
Word
depth :: Word
negNumbers :: Bool
depth :: Opts -&gt; Word
negNumbers :: Opts -&gt; Bool
</span><a href="#local-6989586621679115257"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-609"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679115258"><span class="hs-identifier hs-var">negNumbers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-610"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PredType, PredType) -&gt; (PredType, PredType))
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(PredType, PredType) -&gt; (PredType, PredType)
</span><a href="GHC.TypeLits.Normalise.Unify.html#subtractionToPred"><span class="hs-identifier hs-var">subtractionToPred</span></a></span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span class="hs-comment">-- Extract the Nat equality constraints</span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-type">toNatEquality</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatEquality"><span class="hs-identifier hs-type">NatEquality</span></a></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.html#NatInEquality"><span class="hs-identifier hs-type">NatInEquality</span></a></span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Type</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-614"></span><span id="toNatEquality"><span class="annot"><span class="annottext">toNatEquality :: Ct
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="GHC.TypeLits.Normalise.html#toNatEquality"><span class="hs-identifier hs-var hs-var">toNatEquality</span></a></span></span><span> </span><span id="local-6989586621679115255"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Pred
</span><span class="hs-identifier hs-var">classifyPredType</span></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; Pred) -&gt; PredType -&gt; Pred
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; CtEvidence -&gt; PredType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">EqPred</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><span class="hs-identifier hs-var">NomEq</span></span><span> </span><span id="local-6989586621679115254"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115254"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679115253"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115253"><span class="hs-identifier hs-var">t2</span></a></span></span><span>
</span><span id="line-616"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PredType
-&gt; PredType
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115252"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115254"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115253"><span class="hs-identifier hs-var">t2</span></a></span><span>
</span><span id="line-617"></span><span>    </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-619"></span><span>    </span><span id="local-6989586621679115252"><span class="annot"><span class="annottext">go :: PredType
-&gt; PredType
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
</span><a href="#local-6989586621679115252"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679115250"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115250"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621679115249"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115249"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TyConApp</span></span><span> </span><span id="local-6989586621679115248"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span></span><span> </span><span id="local-6989586621679115247"><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115247"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-620"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115250"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span><span>
</span><span id="line-621"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115250"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; [TyCon] -&gt; [TyCon]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">`intersect`</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatAddTyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatSubTyCon</span></span><span>
</span><span id="line-622"></span><span>                                   </span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatMulTyCon</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatExpTyCon</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">((PredType, PredType) -&gt; Bool)
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; ((PredType, PredType) -&gt; Bool) -&gt; (PredType, PredType) -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; PredType -&gt; Bool) -&gt; (PredType, PredType) -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; Bool
</span><span class="hs-identifier hs-var">eqType</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PredType] -&gt; [PredType] -&gt; [(PredType, PredType)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><span class="hs-identifier hs-var">zip</span></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115249"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115247"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-624"></span><span>          </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679115245"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115245"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115244"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115244"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-625"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="#local-6989586621679115243"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115245"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-626"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="#local-6989586621679115243"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115244"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115242"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115242"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115241"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115241"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115245"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-628"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115239"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115239"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115238"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115238"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115244"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatEquality -&gt; Either NatEquality NatInEquality
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115242"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115239"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115241"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115238"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-630"></span><span>          </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-631"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115250"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">typeNatLeqTyCon</span></span><span>
</span><span id="line-632"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679115237"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115237"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115236"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115236"><span class="hs-identifier hs-var">y</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115249"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-633"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115235"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115235"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115234"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115234"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115237"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115233"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115233"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115232"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115232"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115236"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115231"><span class="annot"><span class="annottext">ks :: [(PredType, PredType)]
</span><a href="#local-6989586621679115231"><span class="hs-identifier hs-var hs-var">ks</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115234"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115232"><span class="hs-identifier hs-var">k2</span></a></span><span>
</span><span id="line-636"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-637"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedTrueDataCon</span></span><span>
</span><span id="line-638"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either NatEquality NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115235"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115233"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115231"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-639"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621679115248"><span class="hs-identifier hs-var">tc'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyCon -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier hs-var">promotedFalseDataCon</span></span><span>
</span><span id="line-640"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatInEquality -&gt; Either NatEquality NatInEquality
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115235"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115233"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115231"><span class="hs-identifier hs-var">ks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>         </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>    </span><span class="annot"><a href="#local-6989586621679115252"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621679115230"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115230"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679115229"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115229"><span class="hs-identifier hs-var">y</span></a></span></span><span>
</span><span id="line-644"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="#local-6989586621679115243"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115230"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-645"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Bool
</span><a href="#local-6989586621679115243"><span class="hs-identifier hs-var">isNatKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; PredType -&gt; PredType
PredType -&gt; PredType
</span><span class="hs-identifier hs-var">typeKind</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115229"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115228"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115228"><span class="hs-identifier hs-var">x'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115227"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115227"><span class="hs-identifier hs-var">k1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115230"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-647"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679115226"><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115226"><span class="hs-identifier hs-var">y'</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621679115225"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115225"><span class="hs-identifier hs-var">k2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Writer [(PredType, PredType)] CoreSOP
-&gt; (CoreSOP, [(PredType, PredType)])
forall w a. Writer w a -&gt; (a, w)
</span><span class="hs-identifier hs-var">runWriter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; Writer [(PredType, PredType)] CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#normaliseNat"><span class="hs-identifier hs-var">normaliseNat</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115229"><span class="hs-identifier hs-var">y</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-648"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Either NatEquality NatInEquality, [(PredType, PredType)])
-&gt; Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NatEquality -&gt; Either NatEquality NatInEquality
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115255"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115228"><span class="hs-identifier hs-var">x'</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115226"><span class="hs-identifier hs-var">y'</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115227"><span class="hs-identifier hs-var">k1</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
-&gt; [(PredType, PredType)] -&gt; [(PredType, PredType)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115225"><span class="hs-identifier hs-var">k2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-649"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>
</span><span id="line-650"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Either NatEquality NatInEquality, [(PredType, PredType)])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>    </span><span class="annot"><a href="#local-6989586621679115243"><span class="hs-identifier hs-type">isNatKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-653"></span><span>    </span><span id="local-6989586621679115243"><span class="annot"><span class="annottext">isNatKind :: PredType -&gt; Bool
</span><a href="#local-6989586621679115243"><span class="hs-identifier hs-var hs-var">isNatKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; Bool
</span><span class="hs-operator hs-var">`eqType`</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier hs-var">typeNatKind</span></span><span class="hs-special">)</span><span>
</span><span id="line-654"></span><span>
</span><span id="line-655"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-type">unifyItemToPredType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CoreUnify"><span class="hs-identifier hs-type">CoreUnify</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span id="unifyItemToPredType"><span class="annot"><span class="annottext">unifyItemToPredType :: CoreUnify -&gt; (PredType, PredType)
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToPredType"><span class="hs-identifier hs-var hs-var">unifyItemToPredType</span></a></span></span><span> </span><span id="local-6989586621679115224"><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679115224"><span class="hs-identifier hs-var">ui</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; PredType
</span><span class="hs-identifier hs-var">mkPrimEqPred</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115223"><span class="hs-identifier hs-var">ty1</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115222"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PredType
</span><span class="hs-identifier hs-var">typeNatKind</span></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-659"></span><span>    </span><span id="local-6989586621679115223"><span class="annot"><span class="annottext">ty1 :: PredType
</span><a href="#local-6989586621679115223"><span class="hs-identifier hs-var hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679115224"><span class="hs-identifier hs-var">ui</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-660"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#SubstItem"><span class="hs-identifier hs-type">SubstItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679115219"><span id="local-6989586621679115220"><span class="annot"><span class="annottext">TcTyVar
CoreSOP
siSOP :: forall v c. UnifyItem v c -&gt; SOP v c
siVar :: forall v c. UnifyItem v c -&gt; v
siSOP :: CoreSOP
siVar :: TcTyVar
</span><a href="GHC.TypeLits.Normalise.Unify.html#siSOP"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyVar -&gt; PredType
</span><span class="hs-identifier hs-var">mkTyVarTy</span></span><span> </span><span class="annot"><span class="annottext">TcTyVar
</span><a href="#local-6989586621679115220"><span class="hs-identifier hs-var">siVar</span></a></span><span>
</span><span id="line-661"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#UnifyItem"><span class="hs-identifier hs-type">UnifyItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679115214"><span id="local-6989586621679115215"><span class="annot"><span class="annottext">CoreSOP
siRHS :: forall v c. UnifyItem v c -&gt; SOP v c
siLHS :: forall v c. UnifyItem v c -&gt; SOP v c
siRHS :: CoreSOP
siLHS :: CoreSOP
</span><a href="GHC.TypeLits.Normalise.Unify.html#siRHS"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; PredType
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115215"><span class="hs-identifier hs-var">siLHS</span></a></span><span>
</span><span id="line-662"></span><span>    </span><span id="local-6989586621679115222"><span class="annot"><span class="annottext">ty2 :: PredType
</span><a href="#local-6989586621679115222"><span class="hs-identifier hs-var hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CoreUnify
</span><a href="#local-6989586621679115224"><span class="hs-identifier hs-var">ui</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-663"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#SubstItem"><span class="hs-identifier hs-type">SubstItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679115209"><span id="local-6989586621679115210"><span class="annot"><span class="annottext">TcTyVar
CoreSOP
siSOP :: CoreSOP
siVar :: TcTyVar
siSOP :: forall v c. UnifyItem v c -&gt; SOP v c
siVar :: forall v c. UnifyItem v c -&gt; v
</span><a href="#local-6989586621679115209"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; PredType
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115209"><span class="hs-identifier hs-var">siSOP</span></a></span><span>
</span><span id="line-664"></span><span>            </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#UnifyItem"><span class="hs-identifier hs-type">UnifyItem</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679115207"><span id="local-6989586621679115208"><span class="annot"><span class="annottext">CoreSOP
siRHS :: CoreSOP
siLHS :: CoreSOP
siRHS :: forall v c. UnifyItem v c -&gt; SOP v c
siLHS :: forall v c. UnifyItem v c -&gt; SOP v c
</span><a href="#local-6989586621679115207"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CoreSOP -&gt; PredType
</span><a href="GHC.TypeLits.Normalise.Unify.html#reifySOP"><span class="hs-identifier hs-var">reifySOP</span></a></span><span> </span><span class="annot"><span class="annottext">CoreSOP
</span><a href="#local-6989586621679115207"><span class="hs-identifier hs-var">siRHS</span></a></span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-type">evSubtPreds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span>
</span><span id="line-667"></span><span id="evSubtPreds"><span class="annot"><span class="annottext">evSubtPreds :: Ct -&gt; [(PredType, PredType)] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var hs-var">evSubtPreds</span></a></span></span><span> </span><span id="local-6989586621679115206"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115206"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621679115205"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115205"><span class="hs-identifier hs-var">preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115204"><span class="annot"><span class="annottext">predTypes :: [PredType]
</span><a href="#local-6989586621679115204"><span class="hs-identifier hs-var hs-var">predTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((PredType, PredType) -&gt; PredType)
-&gt; [(PredType, PredType)] -&gt; [PredType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="annot"><span class="annottext">(PredType, PredType) -&gt; PredType
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115205"><span class="hs-identifier hs-var">preds</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,4,1)
</span><span>  </span><span id="local-6989586621679115203"><span class="annot"><span class="annottext">[CoercionHole]
</span><a href="#local-6989586621679115203"><span class="hs-identifier hs-var">holes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; TcPluginM CoercionHole)
-&gt; [PredType] -&gt; TcPluginM [CoercionHole]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; TcPluginM CoercionHole
</span><span class="hs-identifier hs-var">newCoercionHole</span></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; TcPluginM CoercionHole)
-&gt; (PredType -&gt; PredType) -&gt; PredType -&gt; TcPluginM CoercionHole
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; PredType -&gt; PredType)
-&gt; (PredType, PredType) -&gt; PredType
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><span class="hs-identifier hs-var">uncurry</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; PredType -&gt; PredType
</span><span class="hs-identifier hs-var">mkPrimEqPred</span></span><span> </span><span class="annot"><span class="annottext">((PredType, PredType) -&gt; PredType)
-&gt; (PredType -&gt; (PredType, PredType)) -&gt; PredType -&gt; PredType
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PredType -&gt; (PredType, PredType)
</span><span class="hs-identifier hs-var">getEqPredTys</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115204"><span class="hs-identifier hs-var">predTypes</span></a></span><span class="hs-cpp">
#else
</span><span>  </span><span class="hs-identifier">holes</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">replicateM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">preds</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">newCoercionHole</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">[Ct] -&gt; TcPluginM [Ct]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PredType -&gt; CoercionHole -&gt; Ct)
-&gt; [PredType] -&gt; [CoercionHole] -&gt; [Ct]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><span class="hs-identifier hs-var">zipWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; PredType -&gt; CoercionHole -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToCt"><span class="hs-identifier hs-var">unifyItemToCt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115206"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PredType]
</span><a href="#local-6989586621679115204"><span class="hs-identifier hs-var">predTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[CoercionHole]
</span><a href="#local-6989586621679115203"><span class="hs-identifier hs-var">holes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-type">evMagic</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Kind</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">EvTerm</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-677"></span><span id="evMagic"><span class="annot"><span class="annottext">evMagic :: Ct
-&gt; Set CType
-&gt; [(PredType, PredType)]
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
</span><a href="GHC.TypeLits.Normalise.html#evMagic"><span class="hs-identifier hs-var hs-var">evMagic</span></a></span></span><span> </span><span id="local-6989586621679115200"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115200"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span id="local-6989586621679115199"><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115199"><span class="hs-identifier hs-var">knW</span></a></span></span><span> </span><span id="local-6989586621679115198"><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115198"><span class="hs-identifier hs-var">preds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PredType -&gt; Pred
</span><span class="hs-identifier hs-var">classifyPredType</span></span><span> </span><span class="annot"><span class="annottext">(PredType -&gt; Pred) -&gt; PredType -&gt; Pred
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; PredType
</span><span class="hs-identifier hs-var">ctEvPred</span></span><span> </span><span class="annot"><span class="annottext">(CtEvidence -&gt; PredType) -&gt; CtEvidence -&gt; PredType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtEvidence
</span><span class="hs-identifier hs-var">ctEvidence</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115200"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-678"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">EqPred</span></span><span> </span><span class="annot"><span class="annottext">EqRel
</span><span class="hs-identifier hs-var">NomEq</span></span><span> </span><span id="local-6989586621679115197"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115197"><span class="hs-identifier hs-var">t1</span></a></span></span><span> </span><span id="local-6989586621679115196"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115196"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-679"></span><span>    </span><span id="local-6989586621679115195"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115195"><span class="hs-identifier hs-var">holeWanteds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; [(PredType, PredType)] -&gt; TcPluginM [Ct]
</span><a href="GHC.TypeLits.Normalise.html#evSubtPreds"><span class="hs-identifier hs-var">evSubtPreds</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115200"><span class="hs-identifier hs-var">ct</span></a></span><span> </span><span class="annot"><span class="annottext">[(PredType, PredType)]
</span><a href="#local-6989586621679115198"><span class="hs-identifier hs-var">preds</span></a></span><span>
</span><span id="line-680"></span><span>    </span><span id="local-6989586621679115194"><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115194"><span class="hs-identifier hs-var">knWanted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(CType -&gt; TcPluginM Ct) -&gt; [CType] -&gt; TcPluginM [Ct]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><span class="hs-identifier hs-var">mapM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CType -&gt; TcPluginM Ct
</span><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-var">mkKnWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115200"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CType -&gt; [CType]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Set CType
</span><a href="#local-6989586621679115199"><span class="hs-identifier hs-var">knW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-681"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115192"><span class="annot"><span class="annottext">newWant :: [Ct]
</span><a href="#local-6989586621679115192"><span class="hs-identifier hs-var hs-var">newWant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115194"><span class="hs-identifier hs-var">knWanted</span></a></span><span> </span><span class="annot"><span class="annottext">[Ct] -&gt; [Ct] -&gt; [Ct]
forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115195"><span class="hs-identifier hs-var">holeWanteds</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span id="local-6989586621679115191"><span class="annot"><span class="annottext">ctEv :: Coercion
</span><a href="#local-6989586621679115191"><span class="hs-identifier hs-var hs-var">ctEv</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnivCoProvenance -&gt; Role -&gt; PredType -&gt; PredType -&gt; Coercion
</span><span class="hs-identifier hs-var">mkUnivCo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Char] -&gt; UnivCoProvenance
</span><span class="hs-identifier hs-var">PluginProv</span></span><span> </span><span class="annot"><span class="annottext">[Char]
</span><span class="hs-string">&quot;ghc-typelits-natnormalise&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier hs-var">Nominal</span></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115197"><span class="hs-identifier hs-var">t1</span></a></span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115196"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,5,0)
</span><span>    </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((EvTerm, Ct), [Ct]) -&gt; Maybe ((EvTerm, Ct), [Ct])
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvExpr -&gt; EvTerm
</span><span class="hs-identifier hs-var">EvExpr</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Coercion -&gt; EvExpr
forall b. Coercion -&gt; Expr b
</span><span class="hs-identifier hs-var">Coercion</span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621679115191"><span class="hs-identifier hs-var">ctEv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115200"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Ct]
</span><a href="#local-6989586621679115192"><span class="hs-identifier hs-var">newWant</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#else
</span><span>    </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">EvCoercion</span><span> </span><span class="hs-identifier">ctEv</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ct</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier">newWant</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>  </span><span class="annot"><span class="annottext">Pred
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
-&gt; TcPluginM (Maybe ((EvTerm, Ct), [Ct]))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Maybe ((EvTerm, Ct), [Ct])
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-type">mkNonCanonical'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtEvidence</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-691"></span><span id="mkNonCanonical%27"><span class="annot"><span class="annottext">mkNonCanonical' :: CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var hs-var">mkNonCanonical'</span></a></span></span><span> </span><span id="local-6989586621679115187"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679115187"><span class="hs-identifier hs-var">origCtl</span></a></span></span><span> </span><span id="local-6989586621679115186"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115186"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-692"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115185"><span class="annot"><span class="annottext">ct_ls :: RealSrcSpan
</span><a href="#local-6989586621679115185"><span class="hs-identifier hs-var hs-var">ct_ls</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan
</span><span class="hs-identifier hs-var">ctLocSpan</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679115187"><span class="hs-identifier hs-var">origCtl</span></a></span><span>
</span><span id="line-693"></span><span>      </span><span id="local-6989586621679115184"><span class="annot"><span class="annottext">ctl :: CtLoc
</span><a href="#local-6989586621679115184"><span class="hs-identifier hs-var hs-var">ctl</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtEvidence -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctEvLoc</span></span><span>  </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115186"><span class="hs-identifier hs-var">ev</span></a></span><span>
</span><span id="line-694"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Ct -&gt; CtLoc -&gt; Ct
</span><span class="hs-identifier hs-var">setCtLoc</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">mkNonCanonical</span></span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115186"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc -&gt; RealSrcSpan -&gt; CtLoc
</span><span class="hs-identifier hs-var">setCtLocSpan</span></span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679115184"><span class="hs-identifier hs-var">ctl</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621679115185"><span class="hs-identifier hs-var">ct_ls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-type">mkKnWanted</span></a></span><span>
</span><span id="line-697"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-698"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span>
</span><span id="line-699"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TcPluginM</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-700"></span><span id="mkKnWanted"><span class="annot"><span class="annottext">mkKnWanted :: Ct -&gt; CType -&gt; TcPluginM Ct
</span><a href="GHC.TypeLits.Normalise.html#mkKnWanted"><span class="hs-identifier hs-var hs-var">mkKnWanted</span></a></span></span><span> </span><span id="local-6989586621679115183"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115183"><span class="hs-identifier hs-var">ct</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.TypeLits.Normalise.Unify.html#CType"><span class="hs-identifier hs-type">CType</span></a></span><span> </span><span id="local-6989586621679115182"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115182"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-701"></span><span>  </span><span id="local-6989586621679115181"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679115181"><span class="hs-identifier hs-var">kc_clas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcPluginM Class
</span><span class="hs-identifier hs-var">tcLookupClass</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier hs-var">knownNatClassName</span></span><span>
</span><span id="line-702"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115180"><span class="annot"><span class="annottext">kn_pred :: PredType
</span><a href="#local-6989586621679115180"><span class="hs-identifier hs-var hs-var">kn_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [PredType] -&gt; PredType
</span><span class="hs-identifier hs-var">mkClassPred</span></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621679115181"><span class="hs-identifier hs-var">kc_clas</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115182"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-703"></span><span>  </span><span id="local-6989586621679115179"><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115179"><span class="hs-identifier hs-var">wantedCtEv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; PredType -&gt; TcPluginM CtEvidence
</span><span class="hs-identifier hs-var">TcPluginM.newWanted</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115183"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115180"><span class="hs-identifier hs-var">kn_pred</span></a></span><span>
</span><span id="line-704"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679115178"><span class="annot"><span class="annottext">wanted' :: Ct
</span><a href="#local-6989586621679115178"><span class="hs-identifier hs-var hs-var">wanted'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; CtEvidence -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#mkNonCanonical%27"><span class="hs-identifier hs-var">mkNonCanonical'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; CtLoc
</span><span class="hs-identifier hs-var">ctLoc</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115183"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtEvidence
</span><a href="#local-6989586621679115179"><span class="hs-identifier hs-var">wantedCtEv</span></a></span><span>
</span><span id="line-705"></span><span>  </span><span class="annot"><span class="annottext">Ct -&gt; TcPluginM Ct
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621679115178"><span class="hs-identifier hs-var">wanted'</span></a></span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="annot"><a href="GHC.TypeLits.Normalise.html#unifyItemToCt"><span class="hs-identifier hs-type">unifyItemToCt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CtLoc</span></span><span>
</span><span id="line-708"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PredType</span></span><span>
</span><span id="line-709"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CoercionHole</span></span><span>
</span><span id="line-710"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Ct</span></span><span>
</span><span id="line-711"></span><span id="unifyItemToCt"><span class="annot"><span class="annottext">unifyItemToCt :: CtLoc -&gt; PredType -&gt; CoercionHole -&gt; Ct
</span><a href="GHC.TypeLits.Normalise.html#unifyItemToCt"><span class="hs-identifier hs-var hs-var">unifyItemToCt</span></a></span></span><span> </span><span id="local-6989586621679115177"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679115177"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621679115176"><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115176"><span class="hs-identifier hs-var">pred_type</span></a></span></span><span> </span><span id="local-6989586621679115175"><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621679115175"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-712"></span><span>  </span><span class="annot"><span class="annottext">CtEvidence -&gt; Ct
</span><span class="hs-identifier hs-var">mkNonCanonical</span></span><span>
</span><span id="line-713"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PredType -&gt; TcEvDest -&gt; ShadowInfo -&gt; CtLoc -&gt; CtEvidence
</span><span class="hs-identifier hs-var">CtWanted</span></span><span>
</span><span id="line-714"></span><span>      </span><span class="annot"><span class="annottext">PredType
</span><a href="#local-6989586621679115176"><span class="hs-identifier hs-var">pred_type</span></a></span><span>
</span><span id="line-715"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoercionHole -&gt; TcEvDest
</span><span class="hs-identifier hs-var">HoleDest</span></span><span> </span><span class="annot"><span class="annottext">CoercionHole
</span><a href="#local-6989586621679115175"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span class="hs-cpp">
#if MIN_VERSION_ghc(8,2,0)
</span><span>      </span><span class="annot"><span class="annottext">ShadowInfo
</span><span class="hs-identifier hs-var">WDeriv</span></span><span class="hs-cpp">
#endif
</span><span>      </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621679115177"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span></pre></body></html>